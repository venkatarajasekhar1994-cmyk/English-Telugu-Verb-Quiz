<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Hub - Start Playing</title>
    
    <link rel="manifest" href="manifest.json">
    
    <script>
        // Check for service worker support and register it
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered: ', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed: ', error);
                    });
            });
        }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Import all available fonts for customization */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:wght@700&family=Roboto:wght@400;700&family=Merriweather:wght==400;700&family=Playfair+Display:wght@700&family=Montserrat:wght@400;400&family=Source+Sans+3:wght@400;700&display=swap');
        
        /* --- CSS Variables for Theme Management --- */
        
        /* Font Variables */
        :root {
            --font-body: 'Inter', sans-serif;
            --font-title: 'Lora', serif;
            /* Input Variables (Defaults to 'rounded') */
            --input-border-radius: 1.5rem; /* Ultra rounded default */
            --input-shadow: 0 4px 6px rgba(0,0,0,0.05); /* Soft shadow default */
            /* Text Contrast Variables (Defaults to High Contrast for seamlessness) */
            --text-color-light: #111827; /* Near black */
            --text-color-dark: #f3f4f6; /* Near white */
        }
        
        /* Default: Indigo */
        :root,
        body[data-color="indigo"] {
            --color-primary: 79, 70, 229; /* Indigo 600 RGB */
            --color-primary-hex: #4f46e5;
            --color-primary-light: 165, 180, 252; /* Indigo 300 RGB */
            --color-bg-light-start: #a78bfa;
            --color-bg-light-mid: #818cf8;
            --color-bg-light-end: #3b82f6;
            --color-bg-dark-start: #1f2937;
            --color-bg-dark-mid: #111827;
            --color-bg-dark-end: #0f172a;
        }

        /* Teal Theme */
        body[data-color="teal"] {
            --color-primary: 20, 184, 166; /* Teal 600 RGB */
            --color-primary-hex: #14b8a6;
            --color-primary-light: 94, 234, 212; /* Teal 300 RGB */
            --color-bg-light-start: #2dd4bf;
            --color-bg-light-mid: #5eead4;
            --color-bg-light-end: #0d9488;
        }

        /* Rose Theme */
        body[data-color="rose"] {
            --color-primary: 225, 29, 72; /* Rose 600 RGB */
            --color-primary-hex: #e11d48;
            --color-primary-light: 251, 207, 232; /* Rose 300 RGB */
            --color-bg-light-start: #fda4af;
            --color-bg-light-mid: #f43f5e;
            --color-bg-light-end: #e11d48;
        }

        /* Amber Theme (New) */
        body[data-color="amber"] {
            --color-primary: 245, 158, 11; /* Amber 600 RGB */
            --color-primary-hex: #f59e0b;
            --color-primary-light: 253, 230, 138; /* Amber 300 RGB */
            --color-bg-light-start: #fcd34d;
            --color-bg-light-mid: #f59e0b;
            --color-bg-light-end: #fbbf24;
        }
        
        /* Emerald Theme (New) */
        body[data-color="emerald"] {
            --color-primary: 5, 150, 105; /* Emerald 600 RGB */
            --color-primary-hex: #059669;
            --color-primary-light: 110, 231, 183; /* Emerald 300 RGB */
            --color-bg-light-start: #34d399;
            --color-bg-light-mid: #10b981;
            --color-bg-light-end: #059669;
        }
        
        /* --- Base Styles --- */
        body {
            font-family: var(--font-body);
            min-height: 100vh;
            padding: 1rem;
            color: var(--text-color-light); 
            background: linear-gradient(135deg, var(--color-bg-light-start), var(--color-bg-light-mid), var(--color-bg-light-end));
        }
        
        .elegant-title {
            font-family: var(--font-title); 
            font-weight: 700;
            letter-spacing: 0.05em; 
            color: #1e293b;
        }

        /* Main Glass Card */
        .liquid-glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(var(--color-primary-light), 0.35));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: all 0.3s ease;
        }
        
        /* Frosted Glass Effect for Game Options */
        .frosted-option {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s ease, transform 0.1s ease;
        }
        .frosted-option:hover {
            background: rgba(255, 255, 255, 0.7);
        }
        .frosted-option:active {
            transform: scale(0.98); 
        }
        
        /* Custom styles for Game Cards in the Hub */
        .game-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(var(--color-primary), 0.3);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .game-card:hover {
            box-shadow: 0 10px 20px rgba(var(--color-primary), 0.3);
            transform: translateY(-2px) scale(1.02);
            background: rgba(255, 255, 255, 0.9);
        }
        .game-card h2 {
            font-family: var(--font-title);
            color: var(--color-primary-hex);
        }

        /* Play Now Button Styling */
        .play-button {
            display: inline-flex;
            align-items: center;
            padding: 0.5rem 1rem;
            margin-top: 0.75rem;
            background-color: var(--color-primary-hex);
            color: #ffffff;
            font-weight: 700;
            border-radius: 0.75rem; /* Large rounded corners */
            box-shadow: 0 4px 10px rgba(var(--color-primary), 0.4);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        .play-button:hover {
            background-color: rgba(var(--color-primary), 0.9);
            transform: translateY(-1px);
        }
        .play-button:active {
            transform: scale(0.98);
        }

        /* Custom selector list items */
        .selector-item {
            cursor: pointer;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(156, 163, 175, 0.3);
            transition: all 0.2s ease, transform 0.1s ease;
        }
        .selector-item:last-child {
            border-bottom: none;
        }
        .selector-item.selected {
            background-color: rgba(var(--color-primary-light), 0.2);
            font-weight: 600;
        }
        .selector-item:active { /* Subtle press animation */
            transform: scale(0.98); 
        }
        
        /* Custom radio circle */
        .radio-circle {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            border: 2px solid #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .radio-circle.selected {
            border-color: var(--color-primary-hex);
        }
        .radio-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        .radio-dot.selected {
            background-color: var(--color-primary-hex);
        }


        
        /* --- Liquid Glass Ripple Effect --- */
        .ripple-btn {
            position: relative;
            overflow: hidden;
            transform: translate3d(0, 0, 0); 
            z-index: 1;
        }

        .ripple-btn::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.4) 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.6s, opacity 0.8s;
            border-radius: inherit; 
            z-index: -1;
        }

        .ripple-btn:active::after {
            transform: scale(0, 0);
            opacity: 1;
            transition: 0s;
        }
        
        /* --- Dark Mode Styles --- */
        .dark-mode {
            background: linear-gradient(135deg, var(--color-bg-dark-start), var(--color-bg-dark-mid), var(--color-bg-dark-end)); 
            color: var(--text-color-dark);
        }

        /* NEW: Themed Text Hue support in Dark Mode */
        .dark-mode[data-text-hue="themed"] .text-gray-700,
        .dark-mode[data-text-hue="themed"] .text-gray-800,
        .dark-mode[data-text-hue="themed"] .text-gray-600 { 
            color: var(--color-primary-light) !important; 
        }

        /* NEW: Dark mode contrast/input handling */
        .dark-mode input[type="text"], .dark-mode textarea {
            background-color: rgba(31, 41, 55, 0.6) !important;
            color: var(--text-color-dark) !important; 
            border-color: rgba(107, 114, 128, 0.4);
            
            border-radius: var(--input-border-radius); 
            box-shadow: var(--input-shadow);
        }
        
        .dark-mode .liquid-glass-card {
            background: linear-gradient(135deg, rgba(55, 65, 81, 0.4), rgba(31, 41, 55, 0.5));
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); 
        }

        .dark-mode .frosted-option {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(107, 114, 128, 0.4);
        }
        .dark-mode .frosted-option:hover {
            background: rgba(31, 41, 55, 0.8);
        }
        
        .dark-mode .game-card {
            background: rgba(31, 41, 55, 0.7);
            border: 1px solid rgba(var(--color-primary), 0.2);
        }
        .dark-mode .game-card:hover {
            box-shadow: 0 10px 20px rgba(var(--color-primary), 0.5);
            transform: translateY(-2px) scale(1.02);
            background: rgba(31, 41, 55, 0.9);
        }

        .dark-mode .play-button {
            box-shadow: 0 4px 10px rgba(var(--color-primary), 0.8);
        }
        
        .dark-mode .selector-item {
             border-bottom: 1px solid rgba(107, 114, 128, 0.4);
        }
        .dark-mode .selector-item.selected {
            background-color: rgba(var(--color-primary-light), 0.1);
        }
        .dark-mode .radio-circle {
            border: 2px solid #6b7280;
        }
        .dark-mode .radio-dot.selected {
            background-color: var(--color-primary-hex);
        }


        .dark-mode h1,
        .dark-mode .elegant-title { color: #ffffff; }
        
        /* Set color variables for all text based on theme */
        body:not(.dark-mode) .text-gray-700,
        body:not(.dark-mode) .text-gray-800,
        body:not(.dark-mode) .text-gray-600 { color: var(--text-color-light) !important; }
        
        .dark-mode[data-text-hue="default"] .text-gray-700,
        .dark-mode[data-text-hue="default"] .text-gray-800,
        .dark-mode[data-text-hue="default"] .text-gray-600 { color: var(--text-color-dark) !important; }

        /* Modal styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        .selection-modal-content {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s forwards; 
            border-radius: 1.5rem; 
            width: 90%; 
            max-width: 400px;
            margin-bottom: 5vh; 
        }
        
        .modal-content {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

    <div id="hub-container" class="w-full max-w-xl liquid-glass-card p-6 md:p-8 my-8">
        
        <!-- HEADER: Removed Home Link -->
        <div class="flex justify-between items-center mb-6 border-b-2 pb-2 border-primary">
            
            <div class="flex items-center space-x-3"> 
                <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark-mode:text-gray-50 mb-0 elegant-title">
                    GAME HUB
                </h1>
            </div>
            
        </div>
        
        <div class="mt-8 space-y-4">
            
            <!-- NEW: AI English Teacher Card -->
            <div class="game-card shadow-md shadow-red-300/50">
                <h2 class="text-xl font-bold mb-1 text-red-600" style="color: #e11d48;">
                    AI English Teacher (Practice)
                </h2>
                <p class="text-gray-600 dark-mode:text-gray-400">
                    Practice English/Hindi conversations with real-time AI feedback, lessons, and quizzes. **(Requires Internet)**
                </p>
                <!-- UPDATED Play Now Button -->
                <a href="ai_teacher.html" class="play-button ripple-btn bg-rose-600 hover:bg-rose-700 shadow-rose-500/50" style="background-color: #e11d48;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                    Start Practice
                </a>
            </div>

            <!-- English Verbs Quiz Card -->
            <div class="game-card shadow-md shadow-indigo-300/50">
                <h2 class="text-xl font-bold mb-1">English Verbs Quiz</h2>
                <p class="text-gray-600 dark-mode:text-gray-400">Master 4 verb forms with Telugu meanings. (Offline)</p>
                <!-- UPDATED Play Now Button -->
                <a href="Verbs game.html" class="play-button ripple-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.972l-11.54 6.347a1.125 1.125 0 01-1.667-.986V5.653z" />
                    </svg>
                    Play Now
                </a>
            </div>

            <!-- Vocabulary Game Card -->
            <div class="game-card shadow-md shadow-teal-300/50">
                <h2 class="text-xl font-bold mb-1">Vocabulary Game</h2>
                <p class="text-gray-600 dark-mode:text-gray-400">Challenge your intermediate vocabulary. (Offline)</p>
                <!-- UPDATED Play Now Button -->
                <a href="English vocabulary game.html" class="play-button ripple-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.972l-11.54 6.347a1.125 1.125 0 01-1.667-.986V5.653z" />
                    </svg>
                    Play Now
                </a>
            </div>
            
            <!-- Settings Card -->
            <div class="game-card shadow-md shadow-gray-400/50">
                <h2 class="text-xl font-bold mb-1 text-gray-800 dark-mode:text-gray-200" style="color: var(--color-primary-hex);">
                    App Settings
                </h2>
                <p class="text-gray-600 dark-mode:text-gray-400">Customize the look and feel of your game hub and quizzes.</p>
                <a href="#" class="play-button ripple-btn bg-gray-600 hover:bg-gray-700 shadow-gray-400/50" onclick="window.handleUiTapFeedback(); window.openSettings();">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.75 2.924-1.75 3.35 0a1.725 1.725 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.725 1.725 0 001.065 2.572c1.75.426 1.75 2.924 0 3.35a1.725 1.725 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.725 1.725 0 00-2.572 1.065c-.426 1.75-2.924 1.75-3.35 0a1.725 1.725 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.725 1.725 0 00-1.065-2.572c-1.75-.426-1.75-2.924 0-3.35a1.725 1.725 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.228.016 2.573-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
                    </svg>
                    Settings
                </a>
            </div>

            <!-- "Coming Soon" card remains -->
            <div class="game-card opacity-60 pointer-events-none border-dashed border-gray-400">
                 <h2 class="text-xl font-bold mb-1 text-gray-500">New Game Coming Soon!</h2>
                 <p class="text-gray-500">Check back later for a new challenge.</p>
            </div>
            
            <div class="p-4 mt-6 text-center text-sm text-gray-500 dark-mode:text-gray-400 border-t pt-4">
                <p>All games listed here are available offline thanks to PWA caching!</p>
                <p class="text-xs text-red-500 font-semibold mt-1">The AI English Teacher requires an active internet connection to function.</p>
            </div>
            
        </div>
        
    </div>

    <!-- Settings Modal (Copied from game pages) -->
    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay">
        <div class="modal-content liquid-glass-card w-full max-w-sm p-6 overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl font-bold mb-4 text-gray-900 dark-mode:text-gray-100 border-b pb-2 border-primary">App Settings</h2>

            <!-- Settings Persistence Note -->
            <div class="bg-blue-100 dark-mode:bg-blue-900/40 border border-blue-400 text-blue-800 dark-mode:text-blue-200 text-sm p-3 rounded-xl mb-4">
                <p class="font-semibold">All settings are saved automatically to this device only.</p>
            </div>

            <!-- Color Palette Selection -->
            <div class="mb-6">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-3">Color Accent</h3>
                <!-- INCREASED OPTIONS -->
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="setThemeColor('indigo')" data-color-id="indigo"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-indigo-600 hover:opacity-90 text-sm">
                        Indigo
                    </button>
                    <button onclick="setThemeColor('teal')" data-color-id="teal"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-teal-600 hover:opacity-90 text-sm">
                        Teal
                    </button>
                    <button onclick="setThemeColor('rose')" data-color-id="rose"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-rose-600 hover:opacity-90 text-sm">
                        Rose
                    </button>
                    <button onclick="setThemeColor('amber')" data-color-id="amber"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-amber-600 hover:opacity-90 text-sm">
                        Amber
                    </button>
                    <button onclick="setThemeColor('emerald')" data-color-id="emerald"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-emerald-600 hover:opacity-90 text-sm">
                        Emerald
                    </button>
                </div>
            </div>

            <!-- Dark Mode Toggle -->
            <div class="mb-6">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Theme Mode</h3>
                <div class="flex space-x-4">
                    <button onclick="setThemeMode('light')" data-mode-id="light" id="mode-light"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Light
                    </button>
                    <button onclick="setThemeMode('dark')" data-mode-id="dark" id="mode-dark"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Dark
                    </button>
                </div>
            </div>

            <!-- Text Contrast Setting -->
            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Text Contrast</h3>
                <div class="flex space-x-4">
                    <button onclick="setTextContrast('default')" data-contrast-id="default" id="contrast-default"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Default
                    </button>
                    <button onclick="setTextContrast('high')" data-contrast-id="high" id="contrast-high"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        High Contrast
                    </button>
                </div>
            </div>

            <!-- Input Style -->
            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Input Style</h3>
                <div class="flex space-x-4">
                    <button onclick="setInputStyle('rounded')" data-style-id="rounded" id="style-rounded"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Rounded
                    </button>
                    <button onclick="setInputStyle('square')" data-style-id="square" id="style-square"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Square
                    </button>
                </div>
            </div>

            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Feedback Toggles</h3>
                <!-- Audio and Haptic Feedback Toggles - Added ripple-btn to label for touch feedback -->
                <div class="flex flex-col space-y-2">
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-audio" onclick="toggleAudio()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Disable Sound Effects (Click/Correct)</span>
                    </label>
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-haptics" onclick="toggleHaptics()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Disable Vibration (Haptics)</span>
                    </label>
                </div>
            </div>

            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Display</h3>
                <!-- Themed Text Hue Toggle -->
                <div class="flex flex-col space-y-2">
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-text-hue" onclick="toggleTextHue()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Themed Text Hue (Subtle Color Tint)</span>
                    </label>
                </div>
            </div>


            <!-- Body Font Family (NOW A BUTTON THAT OPENS MODAL) -->
            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Body Font</h3>
                <button id="body-font-button" onclick="window.handleUiTapFeedback(); openSelectionModal('body')"
                        class="ripple-btn w-full p-3 flex justify-between items-center rounded-xl border-2 border-gray-300 dark-mode:border-gray-600 focus:ring-primary-hex focus:border-primary-hex transition duration-150 text-gray-800 dark-mode:text-gray-100 frosted-option">
                    <span id="current-body-font" class="font-semibold">Inter (Sans-serif, Default)</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                    </svg>
                </button>
            </div>

            <!-- Title Font Family (NOW A BUTTON THAT OPENS MODAL) -->
            <div class="mb-6">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Title Font</h3>
                <button id="title-font-button" onclick="window.handleUiTapFeedback(); openSelectionModal('title')"
                        class="ripple-btn w-full p-3 flex justify-between items-center rounded-xl border-2 border-gray-300 dark-mode:border-gray-600 focus:ring-primary-hex focus:border-primary-hex transition duration-150 text-gray-800 dark-mode:text-gray-100 frosted-option">
                    <span id="current-title-font" class="font-semibold">Lora (Serif, Default)</span>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-500">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                    </svg>
                </button>
            </div>

            <button onclick="window.handleUiTapFeedback(); window.closeSettings()"
                    class="ripple-btn mt-8 w-full py-3 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 transition duration-150">
                Close Settings
            </button>
        </div>
    </div>
    
    <!-- NEW: Generic Selection Modal (Copied from game pages) -->
    <div id="selection-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="selection-modal-content liquid-glass-card w-full max-w-sm p-0">
            <div class="p-4 flex justify-between items-center border-b dark-mode:border-gray-700">
                <h3 id="selection-modal-title" class="text-xl font-bold text-gray-900 dark-mode:text-gray-100">Select Option</h3>
                <button onclick="window.handleUiTapFeedback(); window.closeSelectionModal()" class="ripple-btn p-2 rounded-full hover:bg-gray-100 dark-mode:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-800 dark-mode:text-gray-200">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="selection-modal-list" class="max-h-80 overflow-y-auto rounded-b-xl">
                <!-- Content populated dynamically -->
            </div>
        </div>
    </div>


    <script>
        // --- Configuration (Copied from game files) ---
        const FONT_OPTIONS = {
            body: [
                { value: 'Inter', label: 'Inter (Sans-serif, Default)' },
                { value: 'Roboto', label: 'Roboto (Sans-serif)' },
                { value: 'Source Sans 3', label: 'Source Sans 3 (Sans-serif)' },
                { value: 'Merriweather', label: 'Merriweather (Serif)' }
            ],
            title: [
                { value: 'Lora', label: 'Lora (Serif, Default)' },
                { value: 'Playfair Display', label: 'Playfair Display (Serif)' },
                { value: 'Montserrat', label: 'Montserrat (Sans-serif)' },
                { value: 'Merriweather', label: 'Merriweather (Serif)' }
            ]
        };
        
        // --- Theme and Settings Management (CRITICAL for consistency) ---
        const DARK_CLASS = 'dark-mode';
        const SETTINGS_KEY = 'quizSettings'; // Key used by Verbs game
        const SETTINGS_KEY_VOCAB = 'vocabQuizSettings'; // Key used by Vocab game
        let currentSelectionType = null;
        
        // Mock Tone.js/Haptics functions for compatibility
        window.handleUiTapFeedback = function() {
            // Placeholder for click sound/vibration
            if (getLocalStorageSetting('disableVibration', false) === false && navigator.vibrate) {
                navigator.vibrate(30);
            }
        }
        
        const getLocalStorageSetting = (key, defaultValue) => {
            try {
                // Check both potential settings keys for the value, prioritizing vocab (more recent game)
                let settings = {};
                let foundValue = undefined;

                const settingsStringVocab = localStorage.getItem(SETTINGS_KEY_VOCAB);
                const settingsStringVerb = localStorage.getItem(SETTINGS_KEY);

                // Priority 1: Vocab Settings
                if (settingsStringVocab) {
                    settings = JSON.parse(settingsStringVocab);
                    if (typeof settings[key] !== 'undefined') foundValue = settings[key];
                }

                // Priority 2: Verb Settings (only if not found in vocab settings)
                if (typeof foundValue === 'undefined' && settingsStringVerb) {
                    settings = JSON.parse(settingsStringVerb);
                    if (typeof settings[key] !== 'undefined') foundValue = settings[key];
                }

                if (typeof foundValue === 'undefined' || foundValue === null) {
                    return defaultValue;
                }
                return foundValue;

            } catch (e) {
                console.error(`Error loading local setting key ${key}:`, e);
                return defaultValue;
            }
        };

        const saveLocalStorageSetting = (key, value) => {
            try {
                // Save to BOTH keys to ensure next game load is consistent
                const keysToUpdate = [SETTINGS_KEY, SETTINGS_KEY_VOCAB];

                keysToUpdate.forEach(storageKey => {
                    const settingsString = localStorage.getItem(storageKey);
                    let settings = settingsString ? JSON.parse(settingsString) : {};
                    settings[key] = value;
                    localStorage.setItem(storageKey, JSON.stringify(settings));
                });
                
            } catch (e) {
                console.error(`Error saving local setting key ${key}:`, e);
            }
        }


        window.setThemeColor = function(color) {
            saveLocalStorageSetting('color', color);
            applyTheme(getLocalStorageSetting('theme', 'light') === 'dark');
            updateSettingsUI();
        }

        window.setThemeMode = function(mode) {
            saveLocalStorageSetting('theme', mode);
            applyTheme(mode === 'dark');
            updateSettingsUI();
        }
        
        window.setTextContrast = function(contrast) {
            saveLocalStorageSetting('contrast', contrast);
            document.body.setAttribute('data-contrast', contrast);
            applyTheme(getLocalStorageSetting('theme', 'light') === 'dark'); 
            updateSettingsUI();
        }
        
        window.setBodyFont = function(font) {
            saveLocalStorageSetting('bodyFont', font);
            const fallback = font.includes('serif') ? 'serif' : 'sans-serif';
            document.documentElement.style.setProperty('--font-body', `"${font}", ${fallback}`);
            updateSettingsUI(); 
        }

        window.setTitleFont = function(font) {
            saveLocalStorageSetting('titleFont', font);
            const fallback = font.includes('serif') ? 'serif' : 'sans-serif'; 
            document.documentElement.style.setProperty('--font-title', `"${font}", ${fallback}`);
            updateSettingsUI(); 
        }
        
        window.setInputStyle = function(style) {
            saveLocalStorageSetting('inputStyle', style);
            applyInputStyles();
            updateSettingsUI();
        }

        function applyInputStyles() {
            const style = getLocalStorageSetting('inputStyle', 'rounded');
            const root = document.documentElement.style;
            if (style === 'square') {
                root.setProperty('--input-border-radius', '0.5rem'); 
                root.setProperty('--input-shadow', '0 2px 4px rgba(0,0,0,0.1)');
            } else { 
                root.setProperty('--input-border-radius', '1.5rem'); 
                root.setProperty('--input-shadow', '0 4px 6px rgba(0,0,0,0.05)');
            }
            // Apply styles to any inputs that might appear on the hub later
            const inputs = document.querySelectorAll('input[type="text"], textarea');
            inputs.forEach(input => {
                input.style.borderRadius = `var(--input-border-radius)`;
                input.style.boxShadow = `var(--input-shadow)`;
            });
        }
        
        window.toggleAudio = function() {
            const currentState = getLocalStorageSetting('disableSound', false);
            saveLocalStorageSetting('disableSound', !currentState);
            updateSettingsUI();
        }

        window.toggleHaptics = function() {
            const currentState = getLocalStorageSetting('disableVibration', false);
            saveLocalStorageSetting('disableVibration', !currentState);
            updateSettingsUI();
        }
        
        window.toggleTextHue = function() {
            const currentState = getLocalStorageSetting('textHue', false);
            saveLocalStorageSetting('textHue', !currentState);
            applyTheme(getLocalStorageSetting('theme', 'light') === 'dark');
            updateSettingsUI();
        }
        
        function applyTheme(isDark) {
            const color = getLocalStorageSetting('color', 'indigo');
            const contrast = getLocalStorageSetting('contrast', 'default');
            const textHue = getLocalStorageSetting('textHue', false);
            const bodyFont = getLocalStorageSetting('bodyFont', 'Inter');
            const titleFont = getLocalStorageSetting('titleFont', 'Lora');
            
            const body = document.body;
            body.setAttribute('data-color', color);
            body.setAttribute('data-contrast', contrast);
            body.setAttribute('data-text-hue', textHue ? 'themed' : 'default');

            if (isDark) {
                body.classList.add(DARK_CLASS);
            } else {
                body.classList.remove(DARK_CLASS);
            }
            
            window.setBodyFont(bodyFont);
            window.setTitleFont(titleFont);
            applyInputStyles();
        }

        function updateSettingsUI() {
            const color = getLocalStorageSetting('color', 'indigo');
            const mode = getLocalStorageSetting('theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
            const contrast = getLocalStorageSetting('contrast', 'default');
            const inputStyle = getLocalStorageSetting('inputStyle', 'rounded');
            const disableSound = getLocalStorageSetting('disableSound', false);
            const disableVibration = getLocalStorageSetting('disableVibration', false);
            const textHue = getLocalStorageSetting('textHue', false);
            
            // Highlight active color
            document.querySelectorAll('.color-option').forEach(btn => {
                btn.classList.toggle('border-white', btn.dataset.colorId === color);
                btn.classList.toggle('border-4', btn.dataset.colorId === color);
            });
            
            // Highlight active mode
            document.querySelectorAll('[data-mode-id]').forEach(btn => {
                const isActive = (btn.dataset.modeId === mode);
                btn.classList.toggle('ring-4', isActive);
                btn.classList.toggle('ring-primary-hex', isActive);
            });

            // Highlight active contrast/input style
            document.querySelectorAll('[data-contrast-id], [data-style-id]').forEach(btn => {
                const isActive = (btn.dataset.contrastId === contrast) || (btn.dataset.styleId === inputStyle);
                btn.classList.toggle('ring-4', isActive);
                btn.classList.toggle('ring-primary-hex', isActive);
            });
            
            // Update toggles
            document.getElementById('toggle-audio').checked = disableSound;
            document.getElementById('toggle-haptics').checked = disableVibration;
            document.getElementById('toggle-text-hue').checked = textHue;
            
            // Update buttons reflecting selected values
            updateFontButton('body');
            updateFontButton('title');
        }

        function getLabel(type, value) {
            const options = FONT_OPTIONS[type];
            const option = options.find(opt => opt.value === value);
            return option ? option.label : value;
        }

        function updateFontButton(type) {
            const id = type === 'body' ? 'current-body-font' : 'current-title-font';
            const value = getLocalStorageSetting(type === 'body' ? 'bodyFont' : 'titleFont', type === 'body' ? 'Inter' : 'Lora');
            const button = document.getElementById(id);
            if (button) {
                button.textContent = getLabel(type, value);
            }
        }

        function renderOption(type, value, label, currentValue, handler) {
            const isSelected = value.toString() === currentValue.toString();
            const selectedClass = isSelected ? 'selected' : '';
            
            let styleAttr = '';
            if (type.includes('font')) {
                const fallback = value.includes('serif') ? 'serif' : 'sans-serif'; 
                styleAttr = `style="font-family: '${value}', ${fallback};"`;
            }

            return `
                <div class="ripple-btn selector-item ${selectedClass}" 
                     onclick="window.handleUiTapFeedback(); ${handler}('${value}')"
                     ${styleAttr}>
                    <span>${label}</span>
                    <div class="radio-circle ${selectedClass}">
                        <div class="radio-dot ${selectedClass}"></div>
                    </div>
                </div>
            `;
        }
        
        // --- Modal Functions (Copied from game files) ---
        
        window.openSelectionModal = function(type) {
            currentSelectionType = type;
            const modal = document.getElementById('selection-modal');
            const titleEl = document.getElementById('selection-modal-title');
            const listEl = document.getElementById('selection-modal-list');
            
            listEl.innerHTML = '';
            let optionsHTML = '';

            switch(type) {
                case 'body':
                    titleEl.textContent = 'Select Body Font';
                    optionsHTML = FONT_OPTIONS.body.map(font => 
                        renderOption('body-font', font.value, font.label, getLocalStorageSetting('bodyFont', 'Inter'), 'handleSelectionChange')
                    ).join('');
                    break;
                case 'title':
                    titleEl.textContent = 'Select Title Font';
                    optionsHTML = FONT_OPTIONS.title.map(font => 
                        renderOption('title-font', font.value, font.label, getLocalStorageSetting('titleFont', 'Lora'), 'handleSelectionChange')
                    ).join('');
                    break;
            }
            
            listEl.innerHTML = optionsHTML;
            modal.classList.remove('hidden');
        }
        
        window.closeSelectionModal = function() {
            document.getElementById('selection-modal').classList.add('hidden');
            currentSelectionType = null;
        }

        window.handleSelectionChange = function(value) {
            switch(currentSelectionType) {
                case 'body':
                    setBodyFont(value);
                    updateFontButton('body');
                    break;
                case 'title':
                    setTitleFont(value);
                    updateFontButton('title');
                    break;
            }
            closeSelectionModal();
        }

        window.openSettings = function() { 
            document.getElementById('settings-modal').classList.remove('hidden'); 
            updateSettingsUI();
        }
        window.closeSettings = function() { 
            document.getElementById('settings-modal').classList.add('hidden'); 
        }

        function loadInitialTheme() {
            const currentMode = getLocalStorageSetting('theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
            applyTheme(currentMode === 'dark');
        }
        
        // Initialize the theme on load
        window.onload = loadInitialTheme;

    </script>
</body>
</html>

