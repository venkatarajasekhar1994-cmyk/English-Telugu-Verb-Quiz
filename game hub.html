<script>
    // --- Theme and Settings Management (CRITICAL for consistency) ---
    // This logic is copied from Verbs game.html to apply the saved theme/color
    const DARK_CLASS = 'dark-mode';
    const SETTINGS_KEY = 'quizSettings'; // Assuming you use this key for all settings

    const getLocalStorageSetting = (key, defaultValue) => {
        try {
            const settingsString = localStorage.getItem(SETTINGS_KEY);
            if (!settingsString) return defaultValue;
            const settings = JSON.parse(settingsString);
            if (typeof settings[key] === 'undefined' || settings[key] === null) {
                return defaultValue;
            }
            return settings[key];
        } catch (e) {
            return defaultValue;
        }
    };

    function applyTheme(isDark) {
        const color = getLocalStorageSetting('color', 'indigo');
        const bodyFont = getLocalStorageSetting('bodyFont', 'Inter');
        const titleFont = getLocalStorageSetting('titleFont', 'Lora');
        
        const body = document.body;
        body.setAttribute('data-color', color);

        if (isDark) {
            body.classList.add(DARK_CLASS);
        } else {
            body.classList.remove(DARK_CLASS);
        }
        
        // Apply Font Styles
        document.documentElement.style.setProperty('--font-body', `'${bodyFont}', sans-serif`);
        document.documentElement.style.setProperty('--font-title', `'${titleFont}', serif`);
    }

    function loadInitialTheme() {
        const currentMode = getLocalStorageSetting('theme', (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
        applyTheme(currentMode === 'dark');
        // NOTE: The hub doesn't need all the updateSettingsUI/HamburgerMenu logic, 
        // but loading the theme here is essential.
    }
    
    // Initialize the theme on load
    window.onload = loadInitialTheme;
</script>
