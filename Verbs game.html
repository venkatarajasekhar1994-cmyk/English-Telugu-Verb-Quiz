<meta name='viewport' content='width=device-width, initial-scale=1'/><meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telugu Verb Quiz</title>
    
    <link rel="manifest" href="manifest.json">
    
    <script>
        // Check for service worker support and register it
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered: ', registration);
                    })
                    .catch(error => {
                        console.error('Service Worker registration failed: ', error);
                    });
            });
        }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    
    <style>
        /* Import all available fonts for customization */
        /* Includes fonts needed for both Default 1 and Default 2 combinations */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Lora:wght@700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&family=Playfair+Display:wght@700&family=Montserrat:wght@400;700&family=Source+Sans+3:wght@400;700&family=Poppins:wght@400;600;700&family=DM+Serif+Display&family=Outfit:wght@400;700&family=Lexend:wght@400;600;700&family=DM+Sans:wght@400;600;700&display=swap');
        
        /* --- CSS Variables for Theme Management --- */
        
        /* Font Variables - Set by JS based on combination or manual selection */
        :root {
            /* Default to Combination 2 (Modern Sans) */
            --font-body: 'Lexend', sans-serif;
            --font-title: 'Montserrat', sans-serif;
            /* Input Variables (Defaults to 'rounded') */
            --input-border-radius: 1.5rem; /* Ultra rounded default */
            --input-shadow: 0 4px 6px rgba(0,0,0,0.05); /* Soft shadow default */
            /* Text Contrast Variables (Defaults to High Contrast for seamlessness) */
            --text-color-light: #111827; /* Near black */
            --text-color-dark: #f3f4f6; /* Near white */
        }
        
        /* Default: Indigo */
        :root,
        body[data-color="Indigo"] { /* UPDATED: Match hub key 'Indigo' */
            --color-primary: 79, 70, 229; /* Indigo 600 RGB */
            --color-primary-hex: #4f46e5;
            --color-primary-light: 165, 180, 252; /* Indigo 300 RGB */
            --color-bg-light-start: #a78bfa;
            --color-bg-light-mid: #818cf8;
            --color-bg-light-end: #3b82f6;
            --color-bg-dark-start: #1f2937;
            --color-bg-dark-mid: #111827;
            --color-bg-dark-end: #0f172a;
        }

        /* Teal Theme */
        body[data-color="Teal"] { /* UPDATED: Match hub key 'Teal' */
            --color-primary: 20, 184, 166; /* Teal 600 RGB */
            --color-primary-hex: #14b8a6;
            --color-primary-light: 94, 234, 212; /* Teal 300 RGB */
            --color-bg-light-start: #2dd4bf;
            --color-bg-light-mid: #5eead4;
            --color-bg-light-end: #0d9488;
            --color-bg-dark-start: #134e4a;
            --color-bg-dark-mid: #115e59;
            --color-bg-dark-end: #0f766e;
        }

        /* Rose Theme */
        body[data-color="Rose"] { /* UPDATED: Match hub key 'Rose' */
            --color-primary: 225, 29, 72; /* Rose 600 RGB */
            --color-primary-hex: #e11d48;
            --color-primary-light: 251, 207, 232; /* Rose 300 RGB */
            --color-bg-light-start: #fda4af;
            --color-bg-light-mid: #f43f5e;
            --color-bg-light-end: #e11d48;
            --color-bg-dark-start: #500724;
            --color-bg-dark-mid: #881337;
            --color-bg-dark-end: #9f1239;
        }

        /* Amber Theme */
        body[data-color="Amber"] { /* UPDATED: Match hub key 'Amber' */
            --color-primary: 245, 158, 11; /* Amber 600 RGB */
            --color-primary-hex: #f59e0b;
            --color-primary-light: 253, 230, 138; /* Amber 300 RGB */
            --color-bg-light-start: #fcd34d;
            --color-bg-light-mid: #f59e0b;
            --color-bg-light-end: #fbbf24;
            --color-bg-dark-start: #78350f;
            --color-bg-dark-mid: #92400e;
            --color-bg-dark-end: #b45309;
        }
        
        /* Emerald Theme */
        body[data-color="Emerald"] { /* UPDATED: Match hub key 'Emerald' */
            --color-primary: 5, 150, 105; /* Emerald 600 RGB */
            --color-primary-hex: #059669;
            --color-primary-light: 110, 231, 183; /* Emerald 300 RGB */
            --color-bg-light-start: #34d399;
            --color-bg-light-mid: #10b981;
            --color-bg-light-end: #059669;
            --color-bg-dark-start: #064e3b;
            --color-bg-dark-mid: #065f46;
            --color-bg-dark-end: #047857;
        }
        
        /* Cyan Theme */
        body[data-color="Cyan"] { /* UPDATED: Match hub key 'Cyan' */
            --color-primary: 8, 145, 178; /* Cyan 600 RGB */
            --color-primary-hex: #0891b2;
            --color-primary-light: 165, 243, 252; /* Cyan 200 RGB */
            --color-bg-light-start: #22d3ee;
            --color-bg-light-mid: #06b6d4;
            --color-bg-light-end: #0891b2;
            --color-bg-dark-start: #164e63;
            --color-bg-dark-mid: #155e75;
            --color-bg-dark-end: #0e7490;
        }

        /* Pink Theme */
        body[data-color="Pink"] { /* UPDATED: Match hub key 'Pink' */
            --color-primary: 219, 39, 119; /* Pink 600 RGB */
            --color-primary-hex: #db2777;
            --color-primary-light: 251, 207, 232; /* Pink 200 RGB */
            --color-bg-light-start: #f9a8d4;
            --color-bg-light-mid: #f472b6;
            --color-bg-light-end: #ec4899;
            --color-bg-dark-start: #500724;
            --color-bg-dark-mid: #831843;
            --color-bg-dark-end: #9d174d;
        }

        /* Orange Theme */
        body[data-color="Orange"] { /* UPDATED: Match hub key 'Orange' */
            --color-primary: 234, 88, 12; /* Orange 600 RGB */
            --color-primary-hex: #ea580c;
            --color-primary-light: 254, 215, 170; /* Orange 200 RGB */
            --color-bg-light-start: #fbbf24;
            --color-bg-light-mid: #f97316;
            --color-bg-light-end: #ea580c;
            --color-bg-dark-start: #7c2d12;
            --color-bg-dark-mid: #9a3412;
            --color-bg-dark-end: #c2410c;
        }

        /* Purple Theme */
        body[data-color="Purple"] { /* UPDATED: Match hub key 'Purple' */
            --color-primary: 147, 51, 234; /* Purple 600 RGB */
            --color-primary-hex: #9333ea;
            --color-primary-light: 221, 214, 254; /* Purple 200 RGB */
            --color-bg-light-start: #c084fc;
            --color-bg-light-mid: #a855f7;
            --color-bg-light-end: #9333ea;
            --color-bg-dark-start: #3b0764;
            --color-bg-dark-mid: #581c87;
            --color-bg-dark-end: #6b21a8;
        }
        
        /* Sky Theme */
        body[data-color="Sky"] { /* UPDATED: Match hub key 'Sky' */
            --color-primary: 2, 132, 199; /* Sky 600 RGB */
            --color-primary-hex: #0284c7;
            --color-primary-light: 186, 230, 253; /* Sky 200 RGB */
            --color-bg-light-start: #38bdf8;
            --color-bg-light-mid: #0ea5e9;
            --color-bg-light-end: #0284c7;
            --color-bg-dark-start: #0c4a6e;
            --color-bg-dark-mid: #075985;
            --color-bg-dark-end: #0369a1;
        }
        
        /* --- Base Styles --- */
        body {
            font-family: var(--font-body);
            min-height: 100vh;
            padding: 1rem;
            color: var(--text-color-light); 
            background: linear-gradient(135deg, var(--color-bg-light-start), var(--color-bg-light-mid), var(--color-bg-light-end));
            transition: background 0.5s ease, color 0.3s ease;
        }
        
        .elegant-title {
            font-family: var(--font-title); 
            font-weight: 700;
            letter-spacing: 0.05em; 
            color: #1e293b;
        }

        /* Main Glass Card */
        .liquid-glass-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(var(--color-primary-light), 0.35));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            transition: all 0.3s ease;
        }
        
        /* Frosted Glass Effect for Settings Options and Buttons */
        .frosted-option, .setting-btn /* Added .setting-btn */ {
            background: rgba(255, 255, 255, 0.5); /* Lighter background for better contrast */
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s ease, transform 0.1s ease;
        }
        .frosted-option:hover, .setting-btn:hover {
            background: rgba(255, 255, 255, 0.7);
        }
        .frosted-option:active, .setting-btn:active { /* Subtle press animation */
            transform: scale(0.98); 
        }

        /* Active state for font combination buttons and manual font buttons */
        .setting-btn.active {
            border-color: var(--color-primary-hex);
            background-color: rgba(var(--color-primary-light), 0.4);
            box-shadow: 0 4px 6px rgba(var(--color-primary), 0.2);
        }

        
        /* Custom selector list items (Quiz Length & Manual Fonts) */
        .selector-item {
            cursor: pointer;
            padding: 0.75rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(156, 163, 175, 0.3);
            transition: all 0.2s ease, transform 0.1s ease;
        }
        .selector-item:last-child {
            border-bottom: none;
        }
        .selector-item.selected {
            background-color: rgba(var(--color-primary-light), 0.2);
            font-weight: 600;
        }
        .selector-item:active { /* Subtle press animation */
            transform: scale(0.98); 
        }
        
        /* Custom radio circle */
        .radio-circle {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            border: 2px solid #9ca3af;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        .radio-circle.selected {
            border-color: var(--color-primary-hex);
        }
        .radio-dot {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        .radio-dot.selected {
            background-color: var(--color-primary-hex);
        }


        /* Prompt box styles */
        .prompt-box {
            background: linear-gradient(135deg, rgba(var(--color-primary-light), 0.6), rgba(var(--color-primary), 0.4)); 
            backdrop-filter: blur(8px);
            border-color: rgba(var(--color-primary), 0.5);
        }
        
        /* --- START: MODIFIED INPUT STYLING --- */
        input[type="text"], input[type="number"], textarea {
            font-family: var(--font-body);
            background-color: rgba(255, 255, 255, 0.5) !important;
            border: 1px solid rgba(156, 163, 175, 0.3);
            color: var(--text-color-light) !important;
            transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.3s ease;
            
            border-radius: var(--input-border-radius); 
            box-shadow: var(--input-shadow);
            
            /* For Quiz Inputs */
            padding: 0.75rem 1rem;
            width: 100%;
        }
        
        /* Override for quiz inputs to add feedback borders */
        input.quiz-input {
             border-width: 2px;
             transition: all 0.2s ease;
        }
        
        input.quiz-input:focus {
             border-color: var(--color-primary-hex) !important;
             box-shadow: 0 0 0 3px rgba(var(--color-primary), 0.3);
             outline: none;
        }
        /* --- END: MODIFIED INPUT STYLING --- */

        .text-primary { color: var(--color-primary-hex); }
        .border-primary { border-color: var(--color-primary-hex); }
        .bg-primary { background-color: var(--color-primary-hex); }
        .shadow-primary { box-shadow: 0 10px 15px -3px rgba(var(--color-primary), 0.2), 0 4px 6px -4px rgba(var(--color-primary), 0.1); }


        /* --- Feedback styling --- */
        /* --- MODIFIED: For inputs instead of buttons --- */
        .correct {
            border-color: rgba(16, 185, 129, 0.7) !important;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.35), rgba(16, 185, 129, 0.1)) !important;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5) !important;
        }
        .incorrect {
            border-color: rgba(239, 68, 68, 0.7) !important;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.35), rgba(239, 68, 68, 0.1)) !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5) !important;
        }
        
        #progress-bar {
            transition: width 0.5s ease-in-out;
            background-color: var(--color-primary-hex);
        }
        
        /* --- Liquid Glass Ripple Effect --- */
        .ripple-btn {
            position: relative;
            overflow: hidden;
            transform: translate3d(0, 0, 0); /* Force GPU acceleration */
            z-index: 1;
        }

        .ripple-btn::after {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            /* Use radial gradient for a soft, liquid ripple look */
            background-image: radial-gradient(circle, rgba(255, 255, 255, 0.4) 10%, transparent 10.01%);
            background-repeat: no-repeat;
            background-position: 50%;
            transform: scale(10, 10);
            opacity: 0;
            transition: transform 0.6s, opacity 0.8s;
            border-radius: inherit; /* Inherit the button's rounded corners */
            z-index: -1;
        }

        .ripple-btn:active::after {
            transform: scale(0, 0);
            opacity: 1;
            transition: 0s;
        }

        /* --- START: Added styles for TTS --- */
        .tts-icon {
            display: inline-block;
            margin-left: 0.5rem;
            cursor: pointer;
            font-size: 1.1em; /* Adjust size as needed */
            vertical-align: middle;
            transition: transform 0.1s ease;
        }
        .tts-icon:active {
            transform: scale(0.9);
        }
        /* --- END: Added styles for TTS --- */

        /* --- Dark Mode Styles --- */
        .dark-mode {
            background: linear-gradient(135deg, var(--color-bg-dark-start), var(--color-bg-dark-mid), var(--color-bg-dark-end)); 
            color: var(--text-color-dark);
        }
        
        .dark-mode[data-text-hue="themed"] .text-gray-700,
        .dark-mode[data-text-hue="themed"] .text-gray-800,
        .dark-mode[data-text-hue="themed"] .text-gray-600 { 
            color: var(--color-primary-light); /* Use light primary color for text tint */
        }
        
        .dark-mode .liquid-glass-card {
            background: linear-gradient(135deg, rgba(55, 65, 81, 0.4), rgba(31, 41, 55, 0.5));
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); 
        }

        .dark-mode .frosted-option, .dark-mode .setting-btn /* Added .setting-btn */ {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid rgba(107, 114, 128, 0.4);
        }
        .dark-mode .frosted-option:hover, .dark-mode .setting-btn:hover {
            background: rgba(31, 41, 55, 0.8);
        }
        
        /* Dark mode active combo/font button */
        .dark-mode .setting-btn.active {
            border-color: var(--color-primary-hex);
            background-color: rgba(var(--color-primary-light), 0.15);
        }
        
        /* Dark mode custom selector styles */
        .dark-mode .selector-item {
             border-bottom: 1px solid rgba(107, 114, 128, 0.4);
        }
        .dark-mode .selector-item.selected {
            background-color: rgba(var(--color-primary-light), 0.1);
        }
        .dark-mode .radio-circle {
            border: 2px solid #6b7280;
        }
        .dark-mode .radio-dot.selected {
            background-color: var(--color-primary-hex);
        }


        .dark-mode h1,
        .dark-mode .elegant-title { color: #ffffff; }

        .dark-mode input[type="text"], .dark-mode input[type="number"], .dark-mode textarea {
            background-color: rgba(31, 41, 55, 0.6) !important;
            color: var(--text-color-dark) !important; 
            border-color: rgba(107, 114, 128, 0.4);
            
            border-radius: var(--input-border-radius); 
            box-shadow: var(--input-shadow);
        }
        
        .dark-mode .prompt-box {
            background: linear-gradient(135deg, rgba(var(--color-primary-light), 0.3), rgba(var(--color-primary), 0.1)) !important;
            border-color: rgba(var(--color-primary), 0.5);
            color: #eef2ff;
        }
        
        /* --- MODIFIED: Dark mode feedback for inputs --- */
        .dark-mode .correct {
            border-color: rgba(52, 211, 153, 0.7) !important;
            background: linear-gradient(135deg, rgba(52, 211, 153, 0.25), rgba(52, 211, 153, 0.1)) !important;
            box-shadow: 0 0 10px rgba(52, 211, 153, 0.6) !important;
        }

        .dark-mode .incorrect {
            border-color: rgba(248, 113, 113, 0.7) !important;
            background: linear-gradient(135deg, rgba(248, 113, 113, 0.25), rgba(248, 113, 113, 0.1)) !important;
            box-shadow: 0 0 10px rgba(248, 113, 113, 0.6) !important;
        }
        
        /* --- START: Added dark mode overrides for results page --- */
        .dark-mode .bg-green-100 { 
            background-color: rgba(20, 83, 45, 0.4) !important; /* This is green-900/40 */
        }
        .dark-mode .bg-red-100 { 
            background-color: rgba(127, 29, 29, 0.4) !important; /* This is red-900/40 */
        }
        .dark-mode .text-green-700 { 
            color: #22c55e !important; /* A light green, e.g., green-500 */
        }
        .dark-mode .text-red-700 { 
            color: #f87171 !important; /* A light red, e.g., red-400 */
        }
        /* --- END: Added dark mode overrides for results page --- */
        
        /* --- END DARK MODE STYLES --- */


        /* Set color variables for all text based on theme */
        body:not(.dark-mode)[data-contrast="default"] .text-gray-700,
        body:not(.dark-mode)[data-contrast="default"] .text-gray-800,
        body:not(.dark-mode)[data-contrast="default"] .text-gray-600 { color: var(--text-color-light) !important; }
        
        .dark-mode[data-contrast="default"] .text-gray-700,
        .dark-mode[data-contrast="default"] .text-gray-800,
        .dark-mode[data-contrast="default"] .text-gray-600 { color: var(--text-color-dark) !important; }

        /* NEW: High Contrast Text Styles */
        body:not(.dark-mode)[data-contrast="high"] .text-gray-700,
        body:not(.dark-mode)[data-contrast="high"] .text-gray-800,
        body:not(.dark-mode)[data-contrast="high"] .text-gray-600,
        body:not(.dark-mode)[data-contrast="high"] {
            color: var(--text-color-light) !important;
        }
        
        .dark-mode[data-contrast="high"] .text-gray-700,
        .dark-mode[data-contrast="high"] .text-gray-800,
        .dark-mode[data-contrast="high"] .text-gray-600,
        .dark-mode[data-contrast="high"] {
            color: var(--text-color-dark) !important;
        }
        
        /* Ensure input text is also high contrast */
        body[data-contrast="high"] input,
        body[data-contrast="high"] textarea {
             color: var(--text-color-light) !important;
        }
         .dark-mode[data-contrast="high"] input,
         .dark-mode[data-contrast="high"] textarea {
             color: var(--text-color-dark) !important;
        }


        /* Modal styles */
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }
        
        /* New selection modal transition: Adjusted to look centered/higher */
        .selection-modal-content {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s forwards; 
            border-radius: 1.5rem; 
            
            width: 90%; 
            max-width: 400px;
            margin-bottom: 5vh; /* Adjusted vertical position */
        }
        
        /* Default modal styles remain for settings/data management */
        .modal-content {
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- START: Added specific dark mode text colors needed --- */
        .dark-mode .text-gray-900 { color: #f9fafb !important; } /* gray-50 */
        .dark-mode .text-gray-800 { color: #f3f4f6 !important; } /* gray-100 */
        .dark-mode .text-gray-700 { color: #e5e7eb !important; } /* gray-200 */
        .dark-mode .text-gray-600 { color: #d1d5db !important; } /* gray-300 */
        /* --- END: Added specific dark mode text colors needed --- */

    </style>
    
    <style>
        /* --- Icon Base Styling --- */
        .icon-primary {
            color: var(--color-primary-hex) !important;
        }
        
        /* --- Icon Animations --- */
        @keyframes pulse-icon {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        @keyframes wiggle-icon {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }
        @keyframes bounce-icon {
            0%, 100% { transform: translateY(0) rotate(0); }
            50% { transform: translateY(-4px) rotate(3deg); }
        }

        /* --- 1. Game Hub (Home) Icon --- */
        #game-container a[href="game hub.html"] svg {
            color: var(--color-primary-hex) !important;
            transition: transform 0.3s ease;
        }
        #game-container a[href="game hub.html"]:hover svg {
            animation: bounce-icon 0.6s ease-in-out;
        }

        /* --- 2. Hamburger Menu Icon --- */
        #hamburger-button svg {
            color: var(--color-primary-hex) !important;
            transition: transform 0.3s ease;
        }
        #hamburger-button:hover svg {
            transform: scale(1.1) rotate(10deg);
        }
        
        /* --- 3. Dropdown Arrow Icon (Chevrons) --- */
        .frosted-option svg {
            color: var(--color-primary-hex);
            transition: transform 0.3s ease;
        }
        .frosted-option:hover svg {
            transform: scale(1.2);
        }

        /* --- 4. Close (X) Icon --- */
        #hamburger-menu button[onclick*="toggleHamburgerMenu"] svg,
        #selection-modal button[onclick*="closeSelectionModal"] svg {
            color: #ef4444; /* Red-500 */
            transition: transform 0.3s ease, color 0.3s ease;
        }
        #hamburger-menu button[onclick*="toggleHamburgerMenu"]:hover svg,
        #selection-modal button[onclick*="closeSelectionModal"]:hover svg {
            transform: scale(1.2) rotate(90deg);
            color: #b91c1c; /* Red-700 */
        }
        .dark-mode #hamburger-menu button[onclick*="toggleHamburgerMenu"] svg,
        .dark-mode #selection-modal button[onclick*="closeSelectionModal"] svg {
            color: #f87171; /* Red-400 */
        }
        .dark-mode #hamburger-menu button[onclick*="toggleHamburgerMenu"]:hover svg,
        .dark-mode #selection-modal button[onclick*="closeSelectionModal"]:hover svg {
            color: #ef4444; /* Red-500 */
        }

        /* --- 5. Theme Toggle Icons (Sun, Moon, System) --- */
        #menu-theme-toggle:hover #menu-theme-icon[class*="text-yellow-500"] {
             transform: rotate(90deg) scale(1.1); /* Sun */
        }
        #menu-theme-toggle:hover #menu-theme-icon[class*="text-purple-400"] {
             transform: scale(1.15); /* Moon */
        }
         #menu-theme-toggle:hover #menu-theme-icon[class*="icon-primary"] {
             transform: scale(1.1); /* System */
        }
        
        /* --- 6. Manage Data Icon (Database) --- */
        button[onclick*="openDataManagementFromMenu"] svg {
            transition: transform 0.3s ease;
        }
        button[onclick*="openDataManagementFromMenu"]:hover svg {
            animation: pulse-icon 1.2s infinite ease-in-out;
        }

        /* --- 7. App Settings Icon (Sliders) --- */
        button[onclick*="openSettings"] svg {
            color: var(--color-primary-hex);
            transition: transform 0.3s ease;
        }
        button[onclick*="openSettings"]:hover svg {
            animation: wiggle-icon 0.5s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

    <div id="game-container" class="w-full max-w-xl liquid-glass-card p-6 md:p-8 my-8">
        
        <div class="flex justify-between items-center mb-6 border-b-2 pb-2 border-primary">
            
            <div class="flex items-center space-x-3">
                 <a href="game hub.html"
                    class="ripple-btn p-2 rounded-full bg-gray-200 hover:bg-gray-300 dark-mode:bg-gray-700 dark-mode:hover:bg-gray-600 transition duration-300 focus:outline-none focus:ring-2 focus:ring-primary-hex"
                    aria-label="Go to Game Hub">
                     <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-800 dark-mode:text-gray-200">
                       <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" />
                     </svg>
                 </a>
                 <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark-mode:text-gray-50 mb-0 elegant-title">
                    VERB FORMS QUIZ
                </h1>
            </div>

            <div class="flex space-x-2">
                <!-- START: MODIFICATION 1 - Replaced button classes for glass effect -->
                <button id="hamburger-button" onclick="window.toggleHamburgerMenu()" 
                        class="ripple-btn p-2 rounded-full transition duration-300 focus:outline-none focus:ring-2 focus:ring-primary-hex frosted-option">
                <!-- END: MODIFICATION 1 -->
                    <svg id="hamburger-icon" class="w-6 h-6 text-gray-800 dark-mode:text-gray-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div id="quiz-status-bar" class="hidden">
            <div class="grid grid-cols-2 gap-4 items-center mb-3">
                <div class="flex items-center space-x-4">
                    <span class="text-gray-600 dark-mode:text-gray-400 text-base">Score: <span id="score-display" class="text-primary text-2xl font-bold">0</span></span>
                    <span class="text-gray-600 dark-mode:text-gray-400 text-base">Q: <span id="question-counter" class="text-primary text-2xl font-bold">0/15</span></span>
                </div>
                <span id="feedback-message" class="text-base font-medium text-right"></span>
            </div>
            
            <div id="progress-bar-container" class="w-full h-2 bg-gray-200 dark-mode:bg-gray-700 rounded-full overflow-hidden mb-6 shadow-inner">
                <div id="progress-bar" class="h-full rounded-full" style="width: 0%;"></div>
            </div>
        </div>


        <div id="start-screen" class="mt-8 text-center">
            <h2 class="text-3xl font-bold text-primary mb-4 elegant-title">Welcome to the Verb Forms Quiz!</h2>
            <p id="start-message" class="text-lg text-gray-700 dark-mode:text-gray-300 mb-8">
                Ready to test your knowledge? Set your quiz options below.
            </p>

            <div class="space-y-4">

                <div class="p-4 bg-primary/5 rounded-xl frosted-option">
                    <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Quiz Length</h3>
                    <button id="quiz-length-button" onclick="handleUiTapFeedback(); openSelectionModal('count')"
                            class="ripple-btn w-full p-3 flex justify-between items-center rounded-xl border-2 border-gray-300 dark-mode:border-gray-600 focus:ring-primary-hex focus:border-primary-hex transition duration-150 text-gray-800 dark-mode:text-gray-100 frosted-option">
                        <span id="current-quiz-length" class="font-semibold">15 Questions (Default)</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                        </svg>
                    </button>
                </div>
                
                <div id="tense-level-button-container" class="hidden p-4 bg-primary/5 rounded-xl frosted-option">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Verb Tense</h3>
                    <button id="tense-level-button" onclick="handleUiTapFeedback(); openSelectionModal('tense')"
                            class="ripple-btn w-full p-3 flex justify-between items-center rounded-xl border-2 border-gray-300 dark-mode:border-gray-600 focus:ring-primary-hex focus:border-primary-hex transition duration-150 text-gray-800 dark-mode:text-gray-100 frosted-option">
                        <span id="current-tense-level" class="font-semibold">All Tenses</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 text-gray-500">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                        </svg>
                    </button>
                </div>

            </div>
            
            <button id="start-quiz-button" onclick="handleUiTapFeedback(); startQuiz()"
                    class="ripple-btn w-full px-4 py-4 mt-8 bg-green-600 text-white font-extrabold rounded-2xl shadow-xl shadow-green-500/50 hover:bg-green-700 transition duration-300 transform hover:scale-[1.01] text-xl disabled:bg-gray-400 disabled:shadow-none"
                    disabled>
                Start Quiz
            </button>
            <p id="loading-indicator" class="mt-4 text-sm text-gray-500">Loading initial data...</p>

        </div>
        
        <div id="question-area" class="space-y-4 hidden">
            <div class="prompt-box p-4 rounded-xl border-2 border-primary text-center">
                <p id="given-form-label" class="text-lg text-indigo-700 dark-mode:text-gray-300">Given Form (Base Form):</p>
                <p id="question-text" class="text-3xl text-indigo-900 font-bold mb-1 dark-mode:text-gray-100">
                    <span id="question-english-text">tease</span><span class="tts-icon" onclick="speakText(document.getElementById('question-english-text').innerText, 'en-US')">🔊</span>
                </p>
                <p id="question-metadata" class="text-lg text-indigo-700 dark-mode:text-gray-300">
                    <span id="question-telugu-text">ఏడిపించడం</span><span class="tts-icon" onclick="speakText(document.getElementById('question-telugu-text').innerText, 'te-IN')">🔊</span>
                </p>
            </div>
        <div id="forms-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                </div>
            
            <div id="explanation-area" class="hidden p-3 mt-4 rounded-xl border-2 border-primary bg-primary/10 dark-mode:bg-primary/5">
                <p class="font-bold text-sm mb-1 text-primary">Correct Answers:</p>
                <p id="explanation-text" class="text-gray-800 dark-mode:text-gray-200 text-base" style="line-height: 1.8;"></p>
            </div>
        </div>

        <div id="quiz-action-buttons" class="mt-8 grid grid-cols-2 gap-4 hidden">
            <button id="skip-button" onclick="handleUiTapFeedback(); skipQuestion()"
                    class="ripple-btn px-2 py-3 bg-yellow-500 text-white font-bold rounded-xl shadow-lg shadow-yellow-500/50 hover:bg-yellow-600 transition duration-150 focus:outline-none focus:ring-4 focus:ring-yellow-500 focus:ring-opacity-50 text-base md:text-lg">
                Skip
            </button>
            <button id="main-action-button" onclick="handleUiTapFeedback(); checkAnswer()"
                    class="ripple-btn px-2 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-indigo-500/50 hover:opacity-90 transition duration-150 disabled:bg-gray-400 focus:outline-none focus:ring-4 focus:ring-primary-hex focus:ring-opacity-50 text-base md:text-lg">
                Check Answer
            </button>
        </div>
        <div id="final-results" class="hidden mt-8 text-center p-4 bg-yellow-300/40 liquid-glass-card border-yellow-300 border-2">
            </div>

    </div>

    <div id="hamburger-menu" class="fixed top-0 right-0 h-full w-64 z-50 transform translate-x-full transition-transform duration-300 bg-white dark-mode:bg-gray-800 shadow-2xl p-6">
        <div class="flex justify-end">
            <button onclick="handleUiTapFeedback(); window.toggleHamburgerMenu()" class="ripple-btn p-2 rounded-full hover:bg-gray-100 dark-mode:hover:bg-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-800 dark-mode:text-gray-200">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <h3 class="text-xl font-bold mb-6 text-gray-900 dark-mode:text-gray-100 border-b pb-2 border-primary">Menu</h3>

        <button id="menu-theme-toggle" onclick="handleUiTapFeedback(); toggleTheme()" 
                class="ripple-btn w-full flex items-center justify-between p-3 mb-4 rounded-xl text-gray-800 dark-mode:text-gray-200 frosted-option hover:bg-opacity-80 transition duration-150">
            <span id="menu-theme-text" class="font-semibold"></span>
            <svg id="menu-theme-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                </svg>
        </button>
        
        <div class="mb-4 p-3 bg-gray-100 dark-mode:bg-gray-700 rounded-xl text-xs text-gray-600 dark-mode:text-gray-400 overflow-x-auto break-all">
            <span class="font-bold">Status:</span> <span id="user-id-display">Local Data Storage</span>
        </div>

        <button onclick="handleUiTapFeedback(); openDataManagementFromMenu()"
                class="ripple-btn w-full flex items-center p-3 mb-4 rounded-xl text-white font-bold bg-primary hover:opacity-90 transition duration-150 shadow-md shadow-indigo-500/50">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.69 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.69-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0c0 2.278-3.69 4.125-8.25 4.125S3.75 12.331 3.75 10.056m16.5 0v3.75m-16.5-3.75v3.75m16.5 0c0 2.278-3.69 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
            </svg>
            Manage Verb Data
        </button>

        <button onclick="handleUiTapFeedback(); window.toggleHamburgerMenu(); openSettings();"
                class="ripple-btn w-full flex items-center p-3 rounded-xl text-gray-800 dark-mode:text-gray-200 frosted-option hover:bg-opacity-80 transition duration-150 shadow-md shadow-gray-500/10">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 12h9.75m-9.75 0a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0h3zm9-6h3.75m-3.75 0a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 18h9.75m-9.75 0a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0" />
            </svg>
            App Settings
        </button>
    </div>
    
    <div id="hamburger-overlay" class="hidden fixed inset-0 z-40 bg-black opacity-50" onclick="handleUiTapFeedback(); window.toggleHamburgerMenu()"></div>

    <div id="settings-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay">
        <div class="modal-content liquid-glass-card w-full max-w-sm p-6 overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl font-bold mb-4 text-gray-900 dark-mode:text-gray-100 border-b pb-2 border-primary">App Settings</h2>

            <div class="bg-blue-100 dark-mode:bg-blue-900/40 border border-blue-400 text-blue-800 dark-mode:text-blue-200 text-sm p-3 rounded-xl mb-4">
                <p class="font-semibold">Shared settings (Theme, Color, Font, Contrast) are synced across all games. Game-specific settings are saved for this game only.</p>
            </div>

            <div class="mb-6">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-3">Color Accent (Shared)</h3>
                <div class="grid grid-cols-5 gap-2">
                    <button onclick="setThemeColor('Indigo')" data-color-id="Indigo"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-indigo-600 hover:opacity-90 text-sm">
                        Indigo
                    </button>
                    <button onclick="setThemeColor('Teal')" data-color-id="Teal"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-teal-600 hover:opacity-90 text-sm">
                        Teal
                    </button>
                    <button onclick="setThemeColor('Rose')" data-color-id="Rose"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-rose-600 hover:opacity-90 text-sm">
                        Rose
                    </button>
                    <button onclick="setThemeColor('Amber')" data-color-id="Amber"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-amber-600 hover:opacity-90 text-sm">
                        Amber
                    </button>
                    <button onclick="setThemeColor('Emerald')" data-color-id="Emerald"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-emerald-600 hover:opacity-90 text-sm">
                        Emerald
                    </button>
                    
                    <button onclick="setThemeColor('Cyan')" data-color-id="Cyan"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-cyan-600 hover:opacity-90 text-sm">
                        Cyan
                    </button>
                    <button onclick="setThemeColor('Pink')" data-color-id="Pink"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-pink-600 hover:opacity-90 text-sm">
                        Pink
                    </button>
                    <button onclick="setThemeColor('Orange')" data-color-id="Orange"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-orange-600 hover:opacity-90 text-sm">
                        Orange
                    </button>
                    <button onclick="setThemeColor('Purple')" data-color-id="Purple"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-purple-600 hover:opacity-90 text-sm">
                        Purple
                    </button>
                    <button onclick="setThemeColor('Sky')" data-color-id="Sky"
                            class="ripple-btn color-option p-2 rounded-xl shadow-md border-2 border-transparent transition duration-150 text-white font-bold bg-sky-600 hover:opacity-90 text-sm">
                        Sky
                    </button>
                    </div>
            </div>

            <div class="mb-6">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Text Contrast (Shared)</h3>
                <div class="flex space-x-4">
                    <button onclick="setTextContrast('default')" data-contrast-id="default" id="contrast-default"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Default
                    </button>
                    <button onclick="setTextContrast('high')" data-contrast-id="high" id="contrast-high"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        High Contrast
                    </button>
                </div>
            </div>

            <!-- START: Font Combination & Manual Section -->
            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                 <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Font Combination (Shared)</h3>
                 <div id="font-combo-btns" class="grid grid-cols-2 gap-2"> 
                      <button onclick="handleUiTapFeedback(); applyFontCombination('default1')" data-combo="default1" class="ripple-btn setting-btn flex-1 py-2 px-3 rounded-lg text-sm text-center">
                          <strong>Default 1</strong><br><span class="text-xs text-gray-500 dark-mode:text-gray-400">Elegant Serif</span>
                      </button>
                      <button onclick="handleUiTapFeedback(); applyFontCombination('default2')" data-combo="default2" class="ripple-btn setting-btn flex-1 py-2 px-3 rounded-lg text-sm text-center">
                          <strong>Default 2</strong><br><span class="text-xs text-gray-500 dark-mode:text-gray-400">Modern Sans</span>
                      </button>
                 </div>
                 <hr class="border-gray-300 dark:border-gray-700 my-4">
                 <span class="font-semibold text-sm text-center block text-gray-600 dark:text-gray-400 mb-2">Or Customize Manually:</span>
                 <div class="space-y-2">
                     <div class="flex items-center justify-between">
                        <span class="font-semibold text-gray-800 dark-mode:text-gray-300 text-base">Title Font</span>
                        <button id="title-font-button" onclick="handleUiTapFeedback(); openSelectionModal('title')"
                                class="ripple-btn setting-btn px-4 py-2 rounded-lg text-sm font-semibold w-40 text-left truncate flex justify-between items-center">
                            <span id="current-title-font" class="truncate">Select Font</span>
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-gray-500 ml-1 flex-shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                            </svg>
                        </button>
                    </div>
                    <div class="flex items-center justify-between">
                         <span class="font-semibold text-gray-800 dark-mode:text-gray-300 text-base">Body Font</span>
                        <button id="body-font-button" onclick="handleUiTapFeedback(); openSelectionModal('body')"
                                class="ripple-btn setting-btn px-4 py-2 rounded-lg text-sm font-semibold w-40 text-left truncate flex justify-between items-center">
                           <span id="current-body-font" class="truncate">Select Font</span>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 text-gray-500 ml-1 flex-shrink-0">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" />
                            </svg>
                        </button>
                    </div>
                 </div>
            </div>
            <!-- END: Font Combination & Manual Section -->

            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Input Style (Game Specific)</h3>
                <div class="flex space-x-4">
                    <button onclick="setInputStyle('rounded')" data-style-id="rounded" id="style-rounded"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Rounded
                    </button>
                    <button onclick="setInputStyle('square')" data-style-id="square" id="style-square"
                            class="ripple-btn flex-1 p-3 rounded-xl border-2 border-transparent text-gray-700 dark-mode:text-gray-300 frosted-option hover:bg-opacity-80 transition duration-150">
                        Square
                    </button>
                </div>
            </div>

            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Feedback (Game Specific)</h3>
                <div class="flex flex-col space-y-2">
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-audio" onclick="toggleAudio()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Disable Sound Effects</span>
                    </label>
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-haptics" onclick="toggleHaptics()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Disable Vibration (Haptics)</span>
                    </label>
                </div>
            </div>

            <div class="mb-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2">Quiz Display (Game Specific)</h3>
                <div class="flex flex-col space-y-2">
                    <label class="ripple-btn flex items-center space-x-3 cursor-pointer p-2 rounded-xl frosted-option hover:bg-opacity-80">
                        <input type="checkbox" id="toggle-text-hue" onclick="toggleTextHue()" 
                                class="form-checkbox h-5 w-5 rounded text-primary-hex border-gray-300 dark-mode:bg-gray-700 transition duration-150 focus:ring-primary-hex">
                        <span class="text-gray-700 dark-mode:text-gray-300">Themed Text Hue (Subtle Color Tint)</span>
                    </label>
                </div>
            </div>
            
            <button onclick="handleUiTapFeedback(); closeSettings()"
                    class="ripple-btn mt-8 w-full py-3 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 transition duration-150">
                Close Settings
            </button>
        </div>
    </div>
    
    <div id="selection-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
        <div class="selection-modal-content liquid-glass-card w-full max-w-sm p-0">
            <div class="p-4 flex justify-between items-center border-b dark-mode:border-gray-700">
                <h3 id="selection-modal-title" class="text-xl font-bold text-gray-900 dark-mode:text-gray-100">Select Option</h3>
                <button onclick="handleUiTapFeedback(); closeSelectionModal()" class="ripple-btn p-2 rounded-full hover:bg-gray-100 dark-mode:hover:bg-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-gray-800 dark-mode:text-gray-200">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="selection-modal-list" class="max-h-80 overflow-y-auto rounded-b-xl">
                <!-- Content added by JS (Quiz Length & Manual Fonts) -->
                </div>
        </div>
    </div>


    <div id="data-management-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 modal-overlay">
        <div class="modal-content liquid-glass-card w-full max-w-3xl p-6 overflow-y-auto max-h-[90vh]">
            <h2 class="text-2xl font-bold mb-4 text-gray-900 dark-mode:text-gray-100 border-b pb-2 border-primary">
                Manage Verb Data (<span id="current-question-count">0</span> Total)
            </h2>
            
            <button id="refresh-base-data" onclick="handleUiTapFeedback(); refreshBaseData()"
                    class="ripple-btn w-full py-2 mb-4 bg-blue-600 text-white font-bold rounded-xl shadow-lg hover:bg-blue-700 transition duration-150">
                Fetch Latest Verbs.csv
            </button>
            <p id="refresh-feedback" class="text-center text-sm font-semibold mt-2 hidden"></p>

            
            <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2 mt-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                Manually Add a Custom Verb (All 5 Forms)
            </h3>
            <p class="text-sm text-gray-600 dark-mode:text-gray-400 mb-4">
                Enter the verb and its 4 other forms. This is added to your **Custom Verbs** list.
            </p>
            
            <div id="add-data-form" class="space-y-4 p-4 bg-primary/5 rounded-xl border border-primary/20 frosted-option">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
                    <div class="space-y-2">
                        <label for="add-v1" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V1 (Base Form)</label>
                        <input type="text" id="add-v1" placeholder="e.g., 'go'" class="w-full p-3">
                    </div>
                    <div class="space-y-2">
                        <label for="add-v1-te" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V1 (Telugu Meaning)</label>
                        <input type="text" id="add-v1-te" placeholder="e.g., 'వెళ్ళు'" class="w-full p-3">
                    </div>
                    
                    <div class="space-y-2">
                        <label for="add-v3s" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V (s/es Form)</label>
                        <input type="text" id="add-v3s" placeholder="e.g., 'goes'" class="w-full p-3">
                    </div>
                    <div class="space-y-2">
                        <label for="add-v3s-te" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V (s/es) (Telugu Meaning)</label>
                        <input type="text" id="add-v3s-te" placeholder="e.g., 'వెళ్తాడు/వెళ్తుంది'" class="w-full p-3">
                    </div>
                    
                    <div class="space-y-2">
                        <label for="add-ving" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V-ing (Present Participle)</label>
                        <input type="text" id="add-ving" placeholder="e.g., 'going'" class="w-full p-3">
                    </div>
                    <div class="space-y-2">
                        <label for="add-ving-te" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V-ing (Telugu Meaning)</label>
                        <input type="text" id="add-ving-te" placeholder="e.g., 'వెళుతూ'" class="w-full p-3">
                    </div>
                    
                    <div class="space-y-2">
                        <label for="add-v2" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V2 (Past Simple)</label>
                        <input type="text" id="add-v2" placeholder="e.g., 'went'" class="w-full p-3">
                    </div>
                    <div class="space-y-2">
                        <label for="add-v2-te" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V2 (Telugu Meaning)</label>
                        <input type="text" id="add-v2-te" placeholder="e.g., 'వెళ్ళింది'" class="w-full p-3">
                    </div>

                    <div class="space-y-2">
                        <label for="add-v3" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V3 (Past Participle)</label>
                        <input type="text" id="add-v3" placeholder="e.g., 'gone'" class="w-full p-3">
                    </div>
                    <div class="space-y-2">
                        <label for="add-v3-te" class="text-sm font-medium text-gray-700 dark-mode:text-gray-300 block">V3 (Telugu Meaning)</label>
                        <input type="text" id="add-v3-te" placeholder="e.g., 'వెళ్ళిపోయాడు'" class="w-full p-3">
                    </div>
                </div>

                <button id="save-question-button" onclick="handleUiTapFeedback(); saveNewQuestionData()"
                        class="ripple-btn w-full py-3 mt-4 bg-primary text-white font-bold rounded-xl shadow-lg hover:opacity-90 transition duration-150 disabled:bg-gray-400">
                    Add Verb
                </button>
                <p id="data-management-feedback" class="text-center text-sm font-semibold mt-2 hidden"></p>
            </div>
            <h3 class="font-semibold text-lg text-gray-800 dark-mode:text-gray-300 mb-2 mt-6 border-t pt-4 border-gray-300 dark-mode:border-gray-700">
                Custom Verbs Added:
            </h3>
            
            <div id="user-data-list" class="space-y-2 max-h-48 overflow-y-auto p-2 border rounded-lg frosted-option">
                <p class="text-center text-gray-500" id="no-user-data">No custom verbs added yet.</p>
            </div>


            <button onclick="handleUiTapFeedback(); closeDataManagement()"
                    class="ripple-btn mt-8 w-full py-3 bg-gray-500 text-white font-bold rounded-xl hover:bg-gray-600 transition duration-150">
                Close Data Management
            </button>
        </div>
    </div>


    <script>
        // Data provided by the user (parsed from the uploaded CSV/Excel sheet)
        const INITIAL_DEFAULT_DATA_KEY = 'initialDefaultVerbData';
        
        // --- Configuration ---
        const QUESTION_OPTIONS = [5, 10, 15, 20, 30, 50]; 
        
        // --- Font Definitions ---
        const FONT_COMBINATIONS = {
            'default1': { title: 'DM Serif Display', body: 'DM Sans' }, // Elegant Serif
            'default2': { title: 'Montserrat', body: 'Lexend' } // Modern Sans (New Default)
        };
        const DEFAULT_FONT_COMBO = 'default2'; 

        // FONT_OPTIONS for manual selection
        const FONT_OPTIONS = {
            title: [
                { value: 'Montserrat', label: 'Montserrat (Modern)' }, 
                { value: 'DM Serif Display', label: 'DM Serif Display (Elegant)' },
                { value: 'Outfit', label: 'Outfit (Modern)' },
                { value: 'Lora', label: 'Lora (Serif)' },
                { value: 'Playfair Display', label: 'Playfair Display (Serif)' },
                { value: 'Merriweather', label: 'Merriweather (Serif)' }
            ],
            body: [
                { value: 'Lexend', label: 'Lexend (Clear)' }, 
                { value: 'DM Sans', label: 'DM Sans (Elegant)' },
                { value: 'Poppins', label: 'Poppins (Friendly)' },
                { value: 'Inter', label: 'Inter (Professional)' },
                { value: 'Roboto', label: 'Roboto (System)' },
                { value: 'Source Sans 3', label: 'Source Sans 3 (Formal)'},
                { value: 'Merriweather', label: 'Merriweather (Serif)' }
            ]
        };
        
        // Color options
        const COLOR_OPTIONS = [ /* ... (COLOR_OPTIONS array unchanged) ... */ 
             { id: 'Indigo', bg: 'bg-indigo-600' }, { id: 'Teal', bg: 'bg-teal-600' }, { id: 'Rose', bg: 'bg-rose-600' }, { id: 'Amber', bg: 'bg-amber-600' }, { id: 'Emerald', bg: 'bg-emerald-600' }, { id: 'Cyan', bg: 'bg-cyan-600' }, { id: 'Pink', bg: 'bg-pink-600' }, { id: 'Orange', bg: 'bg-orange-600' }, { id: 'Purple', bg: 'bg-purple-600' }, { id: 'Sky', bg: 'bg-sky-600' },
        ];
        
        const DEFAULT_MAX_QUESTIONS = 15;

        // --- Game State (No changes) ---
        let maxQuestions = DEFAULT_MAX_QUESTIONS, verbs = [], questionPool = [], quizLimit = DEFAULT_MAX_QUESTIONS, currentQuestionData = null, score = 0, questionsAsked = 0, quizResults = [], isDataLoaded = false, currentSelectionType = null, quizPhase = 'select';

        // --- Storage Keys (No changes) ---
        const GLOBAL_SETTINGS_KEY = 'globalHubSettings', SETTINGS_KEY = 'verbQuizSettings', CUSTOM_DATA_KEY = 'customVerbData';

        // --- CSV Column Indices (No changes) ---
        const COL_V1 = 0, COL_V1_TE = 1, COL_V3S = 2, COL_V3S_TE = 3, COL_VING = 4, COL_VING_TE = 5, COL_V2 = 6, COL_V2_TE = 7, COL_V3 = 8, COL_V3_TE = 9, EXPECTED_COLUMNS = 10;
        
        // --- Audio/Haptic Feedback Setup (No changes) ---
        let correctSynth, incorrectSynth, clickSynth;
        const setupAudio = () => { /* ... (audio setup code unchanged) ... */ 
            correctSynth = new Tone.MembraneSynth().toDestination();
            correctSynth.set({ oscillator: { type: "sine" }, envelope: { attack: 0.001, decay: 0.2, sustain: 0, release: 0.1 }, pitchDecay: 0.05 });
            incorrectSynth = new Tone.NoiseSynth({ noise: { type: "white" }, envelope: { attack: 0.005, decay: 0.1, sustain: 0 } }).toDestination();
            clickSynth = new Tone.Synth({ 
                oscillator: { type: "sine" },
                envelope: { attack: 0.001, decay: 0.05, sustain: 0 }
            }).toDestination();
        };
        const playCorrect = () => { if (!getLocalSetting('disableSound', false)) { Tone.context.resume().then(() => correctSynth.triggerAttackRelease("G5", "8n")); } };
        const playIncorrect = () => { if (!getLocalSetting('disableSound', false)) { Tone.context.resume().then(() => incorrectSynth.triggerAttackRelease("16n")); } };
        const playClick = () => { if (!getLocalSetting('disableSound', false)) { Tone.context.resume().then(() => clickSynth.triggerAttackRelease("C5", "32n")); } };
        const vibrateCorrect = () => { if (!getLocalSetting('disableVibration', false) && navigator.vibrate) navigator.vibrate(100); };
        const vibrateIncorrect = () => { if (!getLocalSetting('disableVibration', false) && navigator.vibrate) navigator.vibrate([100, 50, 100]); };
        const vibrateClick = () => { if (!getLocalSetting('disableVibration', false) && navigator.vibrate) navigator.vibrate(30); };
        window.handleUiTapFeedback = () => { playClick(); vibrateClick(); };

        // --- TTS Function (No changes) ---
        function speakText(text, lang) { /* ... (speakText code unchanged) ... */ 
            if (!text || typeof text !== 'string' || text.trim() === '' || text.trim().toLowerCase() === 'n/a') return;
            if (!('speechSynthesis' in window)) return;
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang;
            const voices = window.speechSynthesis.getVoices();
            const specificVoice = voices.find(voice => voice.lang === lang);
            if (specificVoice) utterance.voice = specificVoice;
            utterance.onerror = (event) => console.error(`TTS Error: ${event.error}`);
            window.speechSynthesis.speak(utterance);
        }
        if ('speechSynthesis' in window && window.speechSynthesis.onvoiceschanged !== undefined) {
             window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        }

        // --- Theme and Settings Management ---
        const DARK_CLASS = 'dark-mode';
        
        // --- Local/Global Settings Helpers (No changes) ---
        const getLocalSetting = (key, defaultValue) => { /* ... (getLocalSetting code unchanged) ... */ 
            try { const s=localStorage.getItem(SETTINGS_KEY); if(!s) return defaultValue; const sets=JSON.parse(s); if(key==='maxQuestions'){ const p=parseInt(sets[key]); return isNaN(p)?defaultValue:p; } return (typeof sets[key]==='undefined'||sets[key]===null)?defaultValue:sets[key]; } catch(e){ console.error(`Error loading local ${key}:`,e); return defaultValue; }
        };
        const saveLocalSetting = (key, value) => { /* ... (saveLocalSetting code unchanged) ... */ 
            try { const s=localStorage.getItem(SETTINGS_KEY); let sets=s?JSON.parse(s):{}; sets[key]=value; localStorage.setItem(SETTINGS_KEY, JSON.stringify(sets)); } catch(e){ console.error(`Error saving local ${key}:`,e); }
        };
        const getGlobalSetting = (key, defaultValue) => { /* ... (getGlobalSetting code unchanged) ... */ 
            try { const s=localStorage.getItem(GLOBAL_SETTINGS_KEY); if(!s) return defaultValue; const sets=JSON.parse(s); return (sets && typeof sets[key] !== 'undefined') ? sets[key] : defaultValue; } catch (e) { console.error(`Error reading global ${key}:`, e); return defaultValue; }
        };
        const setGlobalSetting = (key, value) => { /* ... (setGlobalSetting code unchanged) ... */ 
             try { const s=localStorage.getItem(GLOBAL_SETTINGS_KEY); let sets=s?JSON.parse(s):{}; sets[key]=value; localStorage.setItem(GLOBAL_SETTINGS_KEY, JSON.stringify(sets)); } catch (e) { console.error(`Error saving global ${key}:`, e); }
        };
        
        // --- Apply Settings Functions ---
        function applyAccentColor(colorName) { /* ... (applyAccentColor code unchanged) ... */ 
            if (!colorName || !COLOR_OPTIONS.find(c => c.id === colorName)) colorName = 'Indigo'; document.body.setAttribute('data-color', colorName); 
        }
        function applyTheme(isDark) { /* ... (applyTheme code unchanged) ... */ 
            const body = document.body; const savedTheme = getGlobalSetting('theme', 'auto'); body.classList.toggle(DARK_CLASS, isDark); updateHamburgerMenuUI(savedTheme);
        }
        
        // --- MODIFIED: applyFont applies style and saves individual font name ---
        function applyFont(type, fontFamily) {
            const root = document.documentElement.style;
            let fallback = 'sans-serif';
            let key = '--font-body';
            
            // Determine fallback and CSS variable key
            if (type === 'title') {
                fallback = (fontFamily === 'Lora' || fontFamily === 'Playfair Display' || fontFamily === 'Merriweather' || fontFamily === 'DM Serif Display') ? 'serif' : 'sans-serif';
                key = '--font-title';
            } else { // body
                 fallback = (fontFamily === 'Merriweather') ? 'serif' : 'sans-serif';
            }
            
            // Apply the style
            root.setProperty(key, `"${fontFamily}", ${fallback}`);
            // Save the individual font name
            setGlobalSetting(type === 'title' ? 'titleFont' : 'bodyFont', fontFamily);
        }

        // --- MODIFIED: applyFontCombination applies fonts AND saves combo name + individual names ---
        function applyFontCombination(comboName) {
            const combo = FONT_COMBINATIONS[comboName];
            let appliedComboName = DEFAULT_FONT_COMBO; // Assume default initially

            if (combo) {
                applyFont('title', combo.title); // This also saves titleFont
                applyFont('body', combo.body);   // This also saves bodyFont
                appliedComboName = comboName;    // Set the applied combo name
            } else {
                 // Fallback to default combo if comboName is invalid
                const defaultCombo = FONT_COMBINATIONS[DEFAULT_FONT_COMBO];
                applyFont('title', defaultCombo.title);
                applyFont('body', defaultCombo.body);
            }
            // Save the *combination name* itself
            setGlobalSetting('fontCombination', appliedComboName); 
            updateFontCombinationUI(); // Update UI after applying
        }


        function applyContrast(contrast) { /* ... (applyContrast code unchanged) ... */ 
             if (contrast !== 'high') contrast = 'default'; document.body.setAttribute('data-contrast', contrast); 
        }
        function applyTextHue() { /* ... (applyTextHue code unchanged) ... */ 
            const textHue = getLocalSetting('textHue', false); document.body.setAttribute('data-text-hue', textHue ? 'themed' : 'default'); 
        }
        function applyInputStyles() { /* ... (applyInputStyles code unchanged) ... */ 
            const style = getLocalSetting('inputStyle', 'rounded'); const root = document.documentElement.style; root.setProperty('--input-border-radius', style === 'square' ? '0.5rem' : '1.5rem'); root.setProperty('--input-shadow', style === 'square' ? '0 2px 4px rgba(0,0,0,0.1)' : '0 4px 6px rgba(0,0,0,0.05)');
        }
        
        // --- Toggle/Set Functions (Triggered by UI) ---
        function toggleTheme() { /* ... (toggleTheme code unchanged) ... */ 
            const currentMode = getGlobalSetting('theme', 'auto'); let newMode; if (currentMode === 'auto') newMode = 'light'; else if (currentMode === 'light') newMode = 'dark'; else newMode = 'auto'; setGlobalSetting('theme', newMode); let isDark = (newMode === 'dark') || (newMode === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches); applyTheme(isDark);
        }
        function setThemeColor(color) { /* ... (setThemeColor code unchanged) ... */ 
            setGlobalSetting('colorTheme', color); applyAccentColor(color); updateSettingsUI(); 
        }
        function setTextContrast(contrast) { /* ... (setTextContrast code unchanged) ... */ 
            setGlobalSetting('contrast', contrast); applyContrast(contrast); updateSettingsUI(); 
        }

        // --- NEW: setManualFont handles individual font selection ---
        function setManualFont(type, fontName) {
            applyFont(type, fontName); // Applies and saves the individual font
            // Clear the saved combination setting to indicate manual override
            setGlobalSetting('fontCombination', 'custom'); 
            updateFontCombinationUI(); // De-highlight combo buttons
            updateFontButton(type); // Update the manual button text
        }

        function setInputStyle(style) { /* ... (setInputStyle code unchanged) ... */ 
            saveLocalSetting('inputStyle', style); applyInputStyles(); updateSettingsUI(); 
        }
        function toggleAudio() { /* ... (toggleAudio code unchanged) ... */ 
            saveLocalSetting('disableSound', !getLocalSetting('disableSound', false)); updateSettingsUI(); 
        }
        function toggleHaptics() { /* ... (toggleHaptics code unchanged) ... */ 
            saveLocalSetting('disableVibration', !getLocalSetting('disableVibration', false)); updateSettingsUI(); 
        }
        function toggleTextHue() { /* ... (toggleTextHue code unchanged) ... */ 
             saveLocalSetting('textHue', !getLocalSetting('textHue', false)); applyTextHue(); updateSettingsUI(); 
        }
        window.handleQuestionCountChange = (value) => { /* ... (handleQuestionCountChange code unchanged) ... */ 
             const count = parseInt(value); maxQuestions = count; quizLimit = count; saveLocalSetting('maxQuestions', count); updateStartScreenMessage();
        };
        
        // --- UI Update Functions ---
        
        // updateFontCombinationUI remains the same
        function updateFontCombinationUI() { /* ... (updateFontCombinationUI code unchanged) ... */ 
            const currentCombo = getGlobalSetting('fontCombination', DEFAULT_FONT_COMBO); document.querySelectorAll('#font-combo-btns button').forEach(btn => { btn.classList.toggle('active', btn.dataset.combo === currentCombo); });
        }
        
        // --- NEW: updateFontButton updates manual font button text ---
        function updateFontButton(type) {
            const id = type === 'body' ? 'current-body-font' : 'current-title-font';
            const storageKey = type === 'body' ? 'bodyFont' : 'titleFont';
            // Determine default font based on the *current combo* or overall default
            let defaultFont;
            const currentComboName = getGlobalSetting('fontCombination', DEFAULT_FONT_COMBO);
            const currentCombo = FONT_COMBINATIONS[currentComboName];
            if (currentCombo) {
                 defaultFont = type === 'body' ? currentCombo.body : currentCombo.title;
            } else {
                 // Fallback if combo is somehow invalid or custom
                 const defaultOverallCombo = FONT_COMBINATIONS[DEFAULT_FONT_COMBO];
                 defaultFont = type === 'body' ? defaultOverallCombo.body : defaultOverallCombo.title;
            }

            const value = getGlobalSetting(storageKey, defaultFont); // Get saved individual font
            const buttonTextSpan = document.getElementById(id);
            if (buttonTextSpan) {
                buttonTextSpan.textContent = getFontLabel(type, value); // Use getFontLabel
            }
        }

        // --- MODIFIED: updateSettingsUI updates both combo and manual buttons ---
        function updateSettingsUI() {
            // Read settings
            const color = getGlobalSetting('colorTheme', 'Indigo'); 
            const contrast = getGlobalSetting('contrast', 'default'); 
            const inputStyle = getLocalSetting('inputStyle', 'rounded'); 
            const disableSound = getLocalSetting('disableSound', false); 
            const disableVibration = getLocalSetting('disableVibration', false); 
            const textHue = getLocalSetting('textHue', false); 
            
            // Highlight active color
            document.querySelectorAll('.color-option').forEach(btn => btn.classList.toggle('border-4', btn.dataset.colorId === color)); // Changed highlight
            
            // Highlight contrast/input style
            document.querySelectorAll('[data-contrast-id], [data-style-id]').forEach(btn => {
                const isActive = (btn.dataset.contrastId === contrast) || (btn.dataset.styleId === inputStyle);
                btn.classList.toggle('active', isActive); // Use 'active' class
            });
            
            // Update toggles
            document.getElementById('toggle-audio').checked = disableSound;
            document.getElementById('toggle-haptics').checked = disableVibration;
            document.getElementById('toggle-text-hue').checked = textHue;
            
            // Update quiz length button display
            updateQuizLengthButton(); 
            
            // Update font displays
            updateFontCombinationUI();
            updateFontButton('title');
            updateFontButton('body');

            // Apply primary color to score/counter text
            document.getElementById('score-display').style.color = `var(--color-primary-hex)`;
            document.getElementById('question-counter').style.color = `var(--color-primary-hex)`;
        }
        
        function updateQuizLengthButton() { /* ... (updateQuizLengthButton code unchanged) ... */ 
            const button = document.getElementById('current-quiz-length'); if (button) button.textContent = getLabel('count', maxQuestions); 
        }

        // updateHamburgerMenuUI remains the same
        function updateHamburgerMenuUI(savedTheme) { /* ... (updateHamburgerMenuUI code unchanged) ... */ 
             if (!savedTheme) savedTheme = getGlobalSetting('theme', 'auto'); const icon = document.getElementById('menu-theme-icon'); const text = document.getElementById('menu-theme-text'); icon.className = "w-6 h-6 transition-transform duration-300"; if (savedTheme === 'auto') { icon.classList.add('icon-primary'); icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75..."/>`; text.textContent = "Theme: System"; } else if (savedTheme === 'light') { icon.classList.add('text-yellow-500'); icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1..."/>`; text.textContent = "Theme: Light"; } else { icon.classList.add('text-purple-400'); icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9..."/>`; text.textContent = "Theme: Dark"; }
        }
        
        // --- MODIFIED: loadInitialSettings loads combo OR individual fonts ---
        function loadInitialSettings() {
            // Load GLOBAL settings
            const savedTheme = getGlobalSetting('theme', 'auto'); 
            const colorTheme = getGlobalSetting('colorTheme', 'Indigo'); 
            const savedContrast = getGlobalSetting('contrast', 'default');
            const savedFontCombination = getGlobalSetting('fontCombination', DEFAULT_FONT_COMBO); 
            const savedTitleFont = getGlobalSetting('titleFont'); // May be null if only combo was saved
            const savedBodyFont = getGlobalSetting('bodyFont');   // May be null if only combo was saved

            // Determine dark mode
            let isDark = (savedTheme === 'dark') || (savedTheme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches);
            
            // Apply GLOBAL settings
            applyTheme(isDark); 
            applyAccentColor(colorTheme); 
            applyContrast(savedContrast); 

            // Apply Fonts: Prioritize combination, then individual, then default combination
            if (savedFontCombination && savedFontCombination !== 'custom' && FONT_COMBINATIONS[savedFontCombination]) {
                applyFontCombination(savedFontCombination);
            } else if (savedTitleFont && savedBodyFont) {
                 applyFont('title', savedTitleFont);
                 applyFont('body', savedBodyFont);
                 setGlobalSetting('fontCombination', 'custom'); // Ensure combo is marked as custom
            } else {
                 // Fallback to default combination if nothing specific is saved
                 applyFontCombination(DEFAULT_FONT_COMBO);
            }
            
            // Load LOCAL settings
            maxQuestions = getLocalSetting('maxQuestions', DEFAULT_MAX_QUESTIONS);
            quizLimit = maxQuestions;
            
            // Apply LOCAL settings
            applyInputStyles(); 
            applyTextHue(); 
            
            // Update UI completely
            updateSettingsUI(); 
        }
        
        // --- Modals and Helpers ---

        // --- MODIFIED: openSelectionModal handles 'count', 'body', 'title' ---
        window.openSelectionModal = function(type) {
            currentSelectionType = type;
            const modal = document.getElementById('selection-modal');
            const titleEl = document.getElementById('selection-modal-title');
            const listEl = document.getElementById('selection-modal-list');
            
            listEl.innerHTML = ''; // Clear previous options
            let optionsHTML = '';
            let currentVal;

            if (type === 'count') {
                titleEl.textContent = 'Select Quiz Length';
                currentVal = maxQuestions;
                optionsHTML = QUESTION_OPTIONS.map(count => 
                    renderOption('count', count, `${count} Questions${count === DEFAULT_MAX_QUESTIONS ? ' (Default)' : ''}`, currentVal, 'handleSelectionChange')
                ).join('');
            } else if (type === 'body' || type === 'title') {
                titleEl.textContent = `Select ${type === 'title' ? 'Title' : 'Body'} Font`;
                const options = FONT_OPTIONS[type];
                const storageKey = type === 'body' ? 'bodyFont' : 'titleFont';
                // Default font for comparison logic (uses default combo)
                const defaultCombo = FONT_COMBINATIONS[DEFAULT_FONT_COMBO];
                const defaultFont = type === 'body' ? defaultCombo.body : defaultCombo.title;
                currentVal = getGlobalSetting(storageKey, defaultFont); // Get currently saved individual font

                optionsHTML = options.map(font => 
                    renderOption(type, font.value, font.label, currentVal, 'handleSelectionChange') // Pass font value ('Montserrat')
                ).join('');
            } else {
                // Should not happen, but close modal just in case
                closeSelectionModal();
                return;
            }
            
            listEl.innerHTML = optionsHTML;
            modal.classList.remove('hidden');
        }
        
        window.closeSelectionModal = function() { /* ... (closeSelectionModal code unchanged) ... */ 
            document.getElementById('selection-modal').classList.add('hidden'); currentSelectionType = null; 
        }

        // --- MODIFIED: handleSelectionChange handles 'count', 'body', 'title' ---
        window.handleSelectionChange = function(value) {
            const type = currentSelectionType; // Get the type ('count', 'body', 'title')

            if (type === 'count') {
                handleQuestionCountChange(value);
                updateQuizLengthButton();
            } else if (type === 'body') {
                setManualFont('body', value); // Use the new function
            } else if (type === 'title') {
                setManualFont('title', value); // Use the new function
            }
            closeSelectionModal();
        }

        window.openSettings = function() { /* ... (openSettings code unchanged) ... */ 
             document.getElementById('settings-modal').classList.remove('hidden'); updateSettingsUI(); 
        }
        window.closeSettings = function() { /* ... (closeSettings code unchanged) ... */ 
            document.getElementById('settings-modal').classList.add('hidden'); 
        }
        
        window.toggleHamburgerMenu = function() { /* ... (toggleHamburgerMenu code unchanged including dark mode sync) ... */ 
            handleUiTapFeedback(); const menu = document.getElementById('hamburger-menu'); const overlay = document.getElementById('hamburger-overlay'); const isOpen = menu.classList.contains('translate-x-full'); const isBodyDark = document.body.classList.contains(DARK_CLASS); if (isOpen) { menu.classList.remove('translate-x-full'); menu.classList.add('translate-x-0'); overlay.classList.remove('hidden'); document.body.style.overflow = 'hidden'; menu.classList.toggle(DARK_CLASS, isBodyDark); } else { menu.classList.remove('translate-x-0'); menu.classList.add('translate-x-full'); overlay.classList.add('hidden'); document.body.style.overflow = ''; } updateHamburgerMenuUI(); 
        };
        
        window.openDataManagement = function() { /* ... (openDataManagement code unchanged) ... */ 
            document.getElementById('data-management-modal').classList.remove('hidden'); renderUserDataList(); document.getElementById('current-question-count').textContent = verbs.length; document.getElementById('refresh-feedback').classList.add('hidden');
        }
        window.openDataManagementFromMenu = function() { /* ... (openDataManagementFromMenu code unchanged) ... */ 
             window.toggleHamburgerMenu(); window.openDataManagement(); 
        }
        window.closeDataManagement = function() { /* ... (closeDataManagement code unchanged) ... */ 
            document.getElementById('data-management-modal').classList.add('hidden'); resetQuizAndReloadData(); showDataFeedback('', 'green', true);
        }
        function showDataFeedback(message, type = 'gray', hide = false) { /* ... (showDataFeedback code unchanged) ... */ 
            const fb = document.getElementById('data-management-feedback'); fb.textContent = message; fb.className = `text-center text-sm font-semibold mt-2 text-${type}-600`; fb.classList.toggle('hidden', hide);
        }

        // --- MODIFIED: renderOption handles fonts correctly again ---
        function renderOption(type, value, label, currentValue, handler) {
            const isSelected = value.toString() === currentValue.toString();
            const selectedClass = isSelected ? 'selected' : '';
            
            let styleAttr = '';
            // Apply font style only for font selection items
            if (type === 'body' || type === 'title') {
                 const fallback = (value === 'Lora' || value === 'Playfair Display' || value === 'Merriweather' || value === 'DM Serif Display') ? 'serif' : 'sans-serif'; 
                 styleAttr = `style="font-family: '${value}', ${fallback};"`;
            }

            // Use the same structure for count and fonts
            return `
                <div class="ripple-btn selector-item ${selectedClass}" 
                     onclick="handleUiTapFeedback(); ${handler}('${value}')" ${styleAttr}>
                    <span>${label}</span>
                    <div class="radio-circle ${selectedClass}">
                        <div class="radio-dot ${selectedClass}"></div>
                    </div>
                </div>`;
        }
        
        // --- MODIFIED: getFontLabel gets label for individual fonts ---
        function getFontLabel(type, value) {
            const options = FONT_OPTIONS[type];
            // Clean value just in case it's stored with fallbacks (though it shouldn't be anymore)
            const fontName = value ? value.split(',')[0].replace(/'/g, '') : ''; 
            const option = options.find(opt => opt.value === fontName);
            // Fallback to the value itself if not found, or 'Select Font' if value is missing
            return option ? option.label : (value || 'Select Font'); 
        }

        // getLabel only used for Quiz Length now
        function getLabel(type, value) { /* ... (getLabel code unchanged, only handles 'count') ... */ 
            if (type === 'count') { const limit = parseInt(value); return `${limit} Questions${limit === DEFAULT_MAX_QUESTIONS ? ' (Default)' : ''}`; } return value; 
        }


        function shuffleArray(array) { /* ... (shuffleArray code unchanged) ... */ 
             for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } 
        }
        
        function getFormLabel(formKey) { /* ... (getFormLabel code unchanged) ... */ 
            switch (formKey) { case 'v1': return 'Base Form (V1)'; case 'v3s': return '3rd Person Singular'; case 'ving': return '-ing Form'; case 'v2': return 'Past Simple (V2)'; case 'v3': return 'Past Participle (V3)'; default: return 'Unknown'; } 
        }
        const escape = (text) => text ? text.replace(/'/g, "\\'") : '';
        const tts = (text, lang) => text ? `<span class="tts-icon" onclick="speakText('${escape(text)}', '${lang}')">🔊</span>` : '';


        // --- Data Parsing and Management (No changes) ---
        let baseCsvContent = '';
        async function fetchVerbData() { /* ... (fetchVerbData code unchanged) ... */ 
             if (!localStorage.getItem(INITIAL_DEFAULT_DATA_KEY)) { document.getElementById('loading-indicator').textContent = 'Fetching...'; try { const r=await fetch(`Verbs.csv?t=${new Date().getTime()}`); if (!r.ok) throw new Error(`HTTP ${r.status}`); const txt=await r.text(); localStorage.setItem(INITIAL_DEFAULT_DATA_KEY, txt); baseCsvContent=txt; } catch (e) { console.error("Fetch failed:", e); document.getElementById('start-message').innerHTML='<strong>Error:</strong> Could not load <code>Verbs.csv</code>.'; document.getElementById('loading-indicator').textContent='Load failed.'; return; } } else { baseCsvContent=localStorage.getItem(INITIAL_DEFAULT_DATA_KEY); }
        }
        function parseCSVLine(line) { /* ... (parseCSVLine code unchanged) ... */ 
            const cols = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || []; return cols.map(c => c.trim().replace(/^"|"$/g, '').trim()); 
        }
        function createVerbObject(dataArray, isCustom = false) { /* ... (createVerbObject code unchanged) ... */ 
             if ((!isCustom && dataArray.length < EXPECTED_COLUMNS) || (isCustom && dataArray.length < 10)) return null; const gf = (i) => dataArray[i]?dataArray[i].trim():''; if(isCustom) return {v1:gf(0), v3s:gf(2), ving:gf(4), v2:gf(6), v3:gf(8), telugu:{v1:gf(1)||'N/A', v3s:gf(3)||'N/A', ving:gf(5)||'N/A', v2:gf(7)||'N/A', v3:gf(9)||'N/A'}, source:'custom'}; else return {v1:gf(COL_V1), v3s:gf(COL_V3S), ving:gf(COL_VING), v2:gf(COL_V2), v3:gf(COL_V3), telugu:{v1:gf(COL_V1_TE)||'N/A', v3s:gf(COL_V3S_TE)||'N/A', ving:gf(COL_VING_TE)||'N/A', v2:gf(COL_V2_TE)||'N/A', v3:gf(COL_V3_TE)||'N/A'}, source:'base'};
        }
        function loadCustomVerbs() { /* ... (loadCustomVerbs code unchanged) ... */ 
             try { const d=localStorage.getItem(CUSTOM_DATA_KEY); return d?JSON.parse(d):[]; } catch(e){ console.error("Load custom failed:",e); localStorage.removeItem(CUSTOM_DATA_KEY); return []; } 
        }
        function saveCustomVerbs(data) { /* ... (saveCustomVerbs code unchanged) ... */ 
             try { localStorage.setItem(CUSTOM_DATA_KEY, JSON.stringify(data)); } catch(e){ console.error("Save custom failed:",e); } 
        }
        function parseAndLoadVerbs() { /* ... (parseAndLoadVerbs code unchanged) ... */ 
             let bv=[]; if(baseCsvContent){ const ls=baseCsvContent.trim().split('\n').slice(1); ls.forEach(l => { const v=createVerbObject(parseCSVLine(l), false); if(v) bv.push(v); }); } else console.warn("parse: base empty."); const cv=loadCustomVerbs(); verbs=[...bv, ...cv]; isDataLoaded=true; document.getElementById('current-question-count').textContent=verbs.length; updateStartScreenMessage(); return bv.length;
        }
        function renderUserDataList() { /* ... (renderUserDataList code unchanged) ... */ 
             const le=document.getElementById('user-data-list'); const cv=loadCustomVerbs(); le.innerHTML=''; if(cv.length===0){ le.innerHTML='<p class="text-center text-gray-500" id="no-user-data">No custom verbs.</p>'; return; } cv.forEach((v, i)=>{ const item=document.createElement('div'); item.className='flex justify-between items-start p-2 border-b dark-mode:border-gray-700 hover:bg-opacity-80 rounded-md'; const tv1=(v.telugu?.v1&&v.telugu.v1!=='N/A')?` (${v.telugu.v1})`:''; item.innerHTML=`<div class="flex-1 min-w-0 mr-4"><span class="font-semibold text-primary dark-mode:text-primary-light line-clamp-1">${v.v1}${tv1}</span><p class="text-xs text-gray-600 dark-mode:text-gray-400 truncate">${v.v3s}/${v.ving}/${v.v2}/${v.v3}</p></div><button onclick="handleUiTapFeedback(); deleteCustomQuestion(${i})" class="ripple-btn p-2 rounded-lg text-red-500 hover:text-red-700 text-sm flex-shrink-0">Remove</button>`; le.appendChild(item); });
        }
        window.deleteCustomQuestion = (index) => { /* ... (deleteCustomQuestion code unchanged) ... */ 
             const cv=loadCustomVerbs(); if(index>=0&&index<cv.length){ cv.splice(index,1); saveCustomVerbs(cv); renderUserDataList(); parseAndLoadVerbs(); document.getElementById('current-question-count').textContent=verbs.length; showDataFeedback('Verb removed. Restart quiz.','green'); } 
        };
        window.saveNewQuestionData = () => { /* ... (saveNewQuestionData code unchanged) ... */ 
             const ids=['add-v1','add-v1-te','add-v3s','add-v3s-te','add-ving','add-ving-te','add-v2','add-v2-te','add-v3','add-v3-te']; const ins=ids.map(id=>document.getElementById(id)); const vs=ins.map((inp,i)=>(i%2===1)?inp.value.trim():inp.value.trim().toLowerCase()); if([0,2,4,6,8].some(i=>vs[i]==='')){ showDataFeedback('Fill ALL 5 English forms.','red'); return; } const nv=createVerbObject(vs, true); if(!nv){ showDataFeedback('Error creating verb.','red'); return; } const cv=loadCustomVerbs(); if(cv.some(v=>v.v1.toLowerCase()===nv.v1.toLowerCase())){ showDataFeedback(`'${nv.v1}' already exists.`,'red'); return; } cv.push(nv); saveCustomVerbs(cv); parseAndLoadVerbs(); ins.forEach(inp=>inp.value=''); showDataFeedback(`'${nv.v1}' added. Restart quiz.`,'green'); renderUserDataList(); document.getElementById('current-question-count').textContent=verbs.length;
        };
        window.refreshBaseData = async () => { /* ... (refreshBaseData code unchanged) ... */ 
             const fb=document.getElementById('refresh-feedback'); fb.className='text-center text-sm font-semibold mt-2 text-primary'; fb.textContent='Fetching...'; fb.classList.remove('hidden'); try { const r=await fetch(`Verbs.csv?t=${new Date().getTime()}`); if(!r.ok) throw new Error(`HTTP ${r.status}`); const txt=await r.text(); localStorage.setItem(INITIAL_DEFAULT_DATA_KEY, txt); baseCsvContent=txt; const c=parseAndLoadVerbs(); fb.className='text-center text-sm font-semibold mt-2 text-green-600'; fb.textContent=`Success! Reloaded ${c} base (${verbs.length} total). Close window.`; document.getElementById('current-question-count').textContent=verbs.length; } catch(e){ console.error("Refresh failed:",e); fb.className='text-center text-sm font-semibold mt-2 text-red-600'; fb.textContent='Error fetching file.'; }
        };

        // --- Game Logic (No changes needed) ---
        window.startQuiz = () => { /* ... (startQuiz code unchanged) ... */ 
            let avail=verbs; if(avail.length<1){ document.getElementById('start-message').innerHTML=`Need 1+ verb.`; document.getElementById('loading-indicator').textContent=''; return; } quizLimit=Math.min(maxQuestions, avail.length); shuffleArray(avail); questionPool=avail.slice(0, quizLimit); document.getElementById('start-screen').classList.add('hidden'); document.getElementById('quiz-status-bar').classList.remove('hidden'); document.getElementById('question-area').classList.remove('hidden'); document.getElementById('quiz-action-buttons').classList.remove('hidden'); document.getElementById('question-counter').textContent=`0/${quizLimit}`; score=0; questionsAsked=0; quizResults=[]; document.getElementById('score-display').textContent=score; startNextQuestion();
        };
        window.startNextQuestion = () => { /* ... (startNextQuestion code unchanged) ... */ 
             if(questionsAsked>=quizLimit||questionPool.length===0){ endGame(); return; } document.getElementById('feedback-message').textContent=''; document.getElementById('final-results').classList.add('hidden'); document.getElementById('explanation-area').classList.add('hidden'); const btn=document.getElementById('main-action-button'); btn.textContent='Check Answer'; btn.disabled=false; document.getElementById('skip-button').disabled=false; quizPhase='select'; currentQuestionData=questionPool.shift(); questionsAsked++; const forms=['v1','v3s','ving','v2','v3']; currentQuestionData.givenFormKey=forms[Math.floor(Math.random()*forms.length)]; renderQuestion(); updateProgressBar();
        };
        function renderQuestion() { /* ... (renderQuestion code unchanged) ... */ 
             if(!currentQuestionData) return; const gk=currentQuestionData.givenFormKey; const gv=currentQuestionData[gk]; const gl=getFormLabel(gk); document.getElementById('question-counter').textContent=`${questionsAsked}/${quizLimit}`; document.getElementById('question-english-text').textContent=gv; document.getElementById('given-form-label').textContent=`Given Form (${gl}):`; const tm=(currentQuestionData.telugu?.[gk]&&currentQuestionData.telugu[gk]!=='N/A')?currentQuestionData.telugu[gk]:'(No meaning)'; document.getElementById('question-telugu-text').textContent=tm; const fc=document.getElementById('forms-container'); fc.innerHTML=''; const forms=['v1','v3s','ving','v2','v3']; let fid=null; forms.forEach(fk=>{ if(fk===gk) return; const fl=getFormLabel(fk); const id=`${fk}-input`; if(!fid) fid=id; fc.innerHTML+=`<div class="space-y-1"><label for="${id}" class="text-sm font-semibold text-gray-700 dark-mode:text-gray-300 ml-2">${fl}</label><input type="text" id="${id}" class="quiz-input" placeholder="Enter ${fl}" autocapitalize="none" autocomplete="off" autocorrect="off" spellcheck="false"></div>`; }); if(fid) setTimeout(()=>{ const fi=document.getElementById(fid); if(fi) fi.focus(); }, 100);
        }
        window.checkAnswer = () => { /* ... (checkAnswer code unchanged) ... */ 
             if(quizPhase==='next'){ startNextQuestion(); return; } if(!currentQuestionData) return; if('speechSynthesis' in window) window.speechSynthesis.cancel(); quizPhase='next'; const gk=currentQuestionData.givenFormKey; const forms=['v1','v3s','ving','v2','v3']; let ac=true; let exp=[]; forms.forEach(fk=>{ if(fk===gk) return; const inp=document.getElementById(`${fk}-input`); const fl=getFormLabel(fk); const ec=currentQuestionData[fk]; const tt=currentQuestionData.telugu?.[fk]&&currentQuestionData.telugu[fk]!=='N/A'?currentQuestionData.telugu[fk]:''; const td=tt?` (${tt})`:''; const ua=inp.value.trim().toLowerCase(); const ca=ec.toLowerCase(); inp.disabled=true; let el=`<strong>${fl}:</strong> ${ec}${td}${tts(ec,'en-US')}${tt?tts(tt,'te-IN'):''}`; if(ua===ca){ inp.classList.add('correct'); el+=` (Correct)`; } else { inp.classList.add('incorrect'); inp.value=ec; ac=false; const ut=ua||'nothing'; el+=` (You: ${ut})`; } exp.push(el); }); const btn=document.getElementById('main-action-button'); document.getElementById('skip-button').disabled=true; if(ac){ score++; document.getElementById('feedback-message').textContent='Correct!'; document.getElementById('feedback-message').className='text-base font-medium text-green-600'; playCorrect(); vibrateCorrect(); } else { document.getElementById('feedback-message').textContent='Check answers.'; document.getElementById('feedback-message').className='text-base font-medium text-red-500'; playIncorrect(); vibrateIncorrect(); document.getElementById('explanation-text').innerHTML=exp.join('<br>'); document.getElementById('explanation-area').classList.remove('hidden'); } document.getElementById('score-display').textContent=score; btn.textContent=(questionsAsked>=quizLimit)?'Finish':'Next'; btn.disabled=false; quizResults.push({qNum:questionsAsked, pForm:gk, pVal:currentQuestionData[gk], cAns:currentQuestionData, isCorrect:ac, isSkipped:false});
        };
        window.skipQuestion = () => { /* ... (skipQuestion code unchanged) ... */ 
             if(quizPhase!=='select'||!currentQuestionData) return; if('speechSynthesis' in window) window.speechSynthesis.cancel(); quizPhase='next'; document.getElementById('feedback-message').textContent='Skipped.'; document.getElementById('feedback-message').className='text-base font-medium text-yellow-600'; quizResults.push({qNum:questionsAsked, pForm:currentQuestionData.givenFormKey, pVal:currentQuestionData[currentQuestionData.givenFormKey], cAns:currentQuestionData, isCorrect:false, isSkipped:true}); startNextQuestion();
        };
        window.endGame = () => { /* ... (endGame code unchanged) ... */ 
             if('speechSynthesis' in window) window.speechSynthesis.cancel(); document.getElementById('question-area').classList.add('hidden'); document.getElementById('quiz-action-buttons').classList.add('hidden'); document.getElementById('quiz-status-bar').classList.add('hidden'); document.getElementById('feedback-message').textContent=''; updateProgressBar(); const tot=quizLimit; const perc=tot>0?((score/tot)*100).toFixed(1):0.0; const sc=(perc>=70)?'text-green-700':(perc>=40?'text-yellow-700':'text-red-700'); const bg=(perc>=70)?'bg-green-300/40 border-green-300':(perc>=40?'bg-yellow-300/40 border-yellow-300':'bg-red-300/40 border-red-300'); let html=`<h3 class="text-2xl font-bold ${sc} mb-2">Quiz Complete!</h3><p class="text-lg text-gray-700 mb-4">Score: <span class="font-bold text-2xl text-primary">${score}</span> / <span class="font-bold text-2xl text-primary">${tot}</span></p><p class="text-xl font-bold text-gray-900 mb-4">Percentage: <span class="text-3xl text-primary">${perc}%</span></p><div class="border-t pt-4 mt-4 border-gray-300 dark-mode:border-gray-700 text-left"><h4 class="text-lg font-bold text-gray-900 mb-3">Review:</h4><div class="space-y-4 max-h-96 overflow-y-auto pr-2">`; if(quizResults.every(r=>r.isCorrect)&&quizResults.length>0) html+=`<p class="text-center text-green-600 font-semibold">Perfect!</p>`; else if(quizResults.length===0) html+=`<p class="text-center text-gray-500">No questions answered.</p>`; quizResults.forEach(r=>{ let scls, stxt, stc; if(r.isCorrect){ scls='bg-green-100 border-green-400'; stxt='CORRECT'; stc='text-green-700'; } else { scls='bg-red-100 border-red-400'; stxt=r.isSkipped?'SKIPPED':'INCORRECT'; stc='text-red-700'; } const gl=getFormLabel(r.pForm); const gv=r.pVal; const v=r.cAns; const tv1=v.telugu?.v1&&v.telugu.v1!=='N/A'?v.telugu.v1:''; const allTTS=['v1','v3s','ving','v2','v3'].map(k=>`${v[k]} ${tts(v[k],'en-US')}`).join(' / '); html+=`<div class="p-3 rounded-xl border-2 ${scls}"><p class="font-bold text-lg flex justify-between items-center mb-1"><span class="text-gray-900">Q${r.qNum}: ${gv} (${gl})</span><span class="text-sm font-extrabold ${stc}">${stxt}</span></p><p class="text-sm text-gray-800">Correct (V1): ${v.v1} ${tts(v.v1,'en-US')}${tv1?`<span class="italic text-primary">(${tv1})</span>${tts(tv1,'te-IN')}`:''}</p><p class="text-xs text-gray-600" style="line-height: 1.8;"><strong>All Forms:</strong> ${allTTS}</p></div>`; }); html+=`</div></div><button onclick="handleUiTapFeedback(); resetQuizAndReloadData()" class="mt-4 inline-block text-primary font-semibold hover:underline">New quiz?</button>`; const fr=document.getElementById('final-results'); fr.innerHTML=html; fr.className=`hidden mt-8 text-center p-4 liquid-glass-card border-2 ${bg}`; fr.classList.remove('hidden');
        };
        window.resetQuizAndReloadData = () => { /* ... (resetQuizAndReloadData code unchanged) ... */ 
             score=0; questionsAsked=0; quizResults=[]; currentQuestionData=null; quizPhase='select'; document.getElementById('quiz-status-bar').classList.add('hidden'); document.getElementById('question-area').classList.add('hidden'); document.getElementById('quiz-action-buttons').classList.add('hidden'); document.getElementById('final-results').classList.add('hidden'); document.getElementById('start-screen').classList.remove('hidden'); document.getElementById('score-display').textContent=score; document.getElementById('feedback-message').textContent=''; parseAndLoadVerbs(); 
        };
        function updateProgressBar() { /* ... (updateProgressBar code unchanged) ... */ 
             const pb=document.getElementById('progress-bar'); const tot=quizLimit; let perc=tot>0?(questionsAsked/tot)*100:0; perc=Math.max(0,Math.min(100,perc)); pb.style.width=`${perc}%`; 
        }
        function updateStartScreenMessage() { /* ... (updateStartScreenMessage code unchanged) ... */ 
             const msg=document.getElementById('start-message'); const btn=document.getElementById('start-quiz-button'); const ind=document.getElementById('loading-indicator'); if(!isDataLoaded){ msg.textContent='Loading...'; btn.disabled=true; ind.classList.remove('hidden'); return; } ind.classList.add('hidden'); updateQuizLengthButton(); let avail=verbs.length; const eff=Math.min(maxQuestions, avail); if(verbs.length===0){ msg.innerHTML='Error: No verbs.'; btn.disabled=true; } else if(eff<1){ msg.innerHTML=`Warning: Need 1+ verb. Have ${avail}.`; btn.disabled=true; } else { const lim=eff<maxQuestions?`(limited by data)`:''; msg.innerHTML=`Quiz: **${eff}** questions ${lim}.`; btn.disabled=false; }
        }

        // --- Initialization ---
        window.onload = async () => {
            setupAudio();
            loadInitialSettings(); // Loads global settings including font combo/manual
            await fetchVerbData(); 
            parseAndLoadVerbs(); 
            
            document.getElementById('tense-level-button-container').style.display = 'none'; // Keep tense hidden

            // System theme change listener
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                if (getGlobalSetting('theme', 'auto') === 'auto') {
                    applyTheme(event.matches); 
                }
            });

            // Storage listener for cross-tab sync
            window.addEventListener('storage', (event) => {
                if (event.key === GLOBAL_SETTINGS_KEY || event.key === SETTINGS_KEY) {
                    console.log("Settings changed in another tab. Applying...");
                    loadInitialSettings(); 
                }
            });
            
            // bfcache listener
            window.addEventListener('pageshow', (event) => {
                if (event.persisted) {
                    console.log("Page from bfcache. Reloading settings.");
                    loadInitialSettings();
                }
            });
            
             // TTS stop on unload
             window.addEventListener('beforeunload', () => { if ('speechSynthesis' in window) window.speechSynthesis.cancel(); });
        };

    </script>
    </body>
</html>


